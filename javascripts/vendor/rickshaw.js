var Rickshaw={namespace:function(e){for(var t=e.split("."),i=Rickshaw,n=1,s=t.length;s>n;n++){var a=t[n];i[a]=i[a]||{},i=i[a]}return i},keys:function(e){var t=[];for(var i in e)t.push(i);return t},extend:function(e,t){for(var i in t)e[i]=t[i];return e},clone:function(e){return JSON.parse(JSON.stringify(e))}};if("undefined"!=typeof module&&module.exports){var d3=require("d3");module.exports=Rickshaw}/*
Copyright (c) 2005-2010 Sam Stephenson

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
!function(e){function t(e){return d.call(e)===k}function i(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function n(e){if(s(e)!==v)throw new TypeError;var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}function s(e){switch(e){case null:return u;case void 0:return f}var t=typeof e;switch(t){case"boolean":return p;case"number":return m;case"string":return g}return v}function a(e){return"undefined"==typeof e}function r(e){var t=e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=t.length||t[0]?t:[]}function h(e,t){var i=e;return function(){var e=o([l(i,this)],arguments);return t.apply(this,e)}}function o(e,t){for(var i=e.length,n=t.length;n--;)e[i+n]=t[n];return e}function c(e,t){return e=w.call(e,0),o(e,t)}function l(e,t){if(arguments.length<2&&a(arguments[0]))return this;var i=e,n=w.call(arguments,2);return function(){var e=c(n,arguments);return i.apply(t,e)}}var d=Object.prototype.toString,u="Null",f="Undefined",p="Boolean",m="Number",g="String",v="Object",k="[object Function]",w=Array.prototype.slice,y=function(){},x=function(){function e(){}function s(){function n(){this.initialize.apply(this,arguments)}var s=null,a=[].slice.apply(arguments);if(t(a[0])&&(s=a.shift()),i(n,x.Methods),n.superclass=s,n.subclasses=[],s){e.prototype=s.prototype,n.prototype=new e;try{s.subclasses.push(n)}catch(r){}}for(var h=0,o=a.length;o>h;h++)n.addMethods(a[h]);return n.prototype.initialize||(n.prototype.initialize=y),n.prototype.constructor=n,n}function a(e){var i=this.superclass&&this.superclass.prototype,s=n(e);o&&(e.toString!=Object.prototype.toString&&s.push("toString"),e.valueOf!=Object.prototype.valueOf&&s.push("valueOf"));for(var a=0,c=s.length;c>a;a++){var d=s[a],u=e[d];if(i&&t(u)&&"$super"==r(u)[0]){var f=u;u=h(function(e){return function(){return i[e].apply(this,arguments)}}(d),f),u.valueOf=l(f.valueOf,f),u.toString=l(f.toString,f)}this.prototype[d]=u}return this}var o=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}();return{create:s,Methods:{addMethods:a}}}();e.exports?e.exports.Class=x:e.Class=x}(Rickshaw),Rickshaw.namespace("Rickshaw.Compat.ClassList"),Rickshaw.Compat.ClassList=function(){"undefined"==typeof document||"classList"in document.createElement("a")||function(e){"use strict";var t="classList",i="prototype",n=(e.HTMLElement||e.Element)[i],s=Object,a=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[i].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1},h=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},o=function(e,t){if(""===t)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},c=function(e){for(var t=a.call(e.className),i=t?t.split(/\s+/):[],n=0,s=i.length;s>n;n++)this.push(i[n]);this._updateClassName=function(){e.className=this.toString()}},l=c[i]=[],d=function(){return new c(this)};if(h[i]=Error[i],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",-1!==o(this,e)},l.add=function(e){e+="",-1===o(this,e)&&(this.push(e),this._updateClassName())},l.remove=function(e){e+="";var t=o(this,e);-1!==t&&(this.splice(t,1),this._updateClassName())},l.toggle=function(e){e+="",-1===o(this,e)?this.add(e):this.remove(e)},l.toString=function(){return this.join(" ")},s.defineProperty){var u={get:d,enumerable:!0,configurable:!0};try{s.defineProperty(n,t,u)}catch(f){-2146823252===f.number&&(u.enumerable=!1,s.defineProperty(n,t,u))}}else s[i].__defineGetter__&&n.__defineGetter__(t,d)}(window)},("undefined"!=typeof RICKSHAW_NO_COMPAT&&!RICKSHAW_NO_COMPAT||"undefined"==typeof RICKSHAW_NO_COMPAT)&&new Rickshaw.Compat.ClassList,Rickshaw.namespace("Rickshaw.Graph"),Rickshaw.Graph=function(e){if(!e.element)throw"Rickshaw.Graph needs a reference to an element";this.element=e.element,this.series=e.series,this.defaults={interpolation:"cardinal",offset:"zero",min:void 0,max:void 0,preserve:!1},Rickshaw.keys(this.defaults).forEach(function(t){this[t]=e[t]||this.defaults[t]},this),this.window={},this.updateCallbacks=[];var t=this;this.initialize=function(e){this.validateSeries(e.series),this.series.active=function(){return t.series.filter(function(e){return!e.disabled})},this.setSize({width:e.width,height:e.height}),this.element.classList.add("rickshaw_graph"),this.vis=d3.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height);for(var i in Rickshaw.Graph.Renderer)if(i&&Rickshaw.Graph.Renderer.hasOwnProperty(i)){var n=Rickshaw.Graph.Renderer[i];n&&n.prototype&&n.prototype.render&&t.registerRenderer(new n({graph:t}))}this.setRenderer(e.renderer||"stack",e),this.discoverRange()},this.validateSeries=function(e){if(!(Array.isArray(e)||e instanceof Rickshaw.Series)){var t=Object.prototype.toString.apply(e);throw"series is not an array: "+t}e.forEach(function(e){if(!(e instanceof Object))throw"series element is not an object: "+e;if(!e.data)throw"series has no data: "+JSON.stringify(e);if(!Array.isArray(e.data))throw"series data is not an array: "+JSON.stringify(e.data);var t=e.data[0].x,i=e.data[0].y;if("number"!=typeof t||"number"!=typeof i&&null!==i)throw"x and y properties of points should be numbers instead of "+typeof t+" and "+typeof i;if(e.data.length>=3&&(e.data[2].x<e.data[1].x||e.data[1].x<e.data[0].x||e.data[e.data.length-1].x<e.data[0].x))throw"series data needs to be sorted on x values for series name: "+e.name},this)},this.dataDomain=function(){var e=this.series.map(function(e){return e.data}),t=d3.min(e.map(function(e){return e[0].x})),i=d3.max(e.map(function(e){return e[e.length-1].x}));return[t,i]},this.discoverRange=function(){var e=this.renderer.domain();this.x=d3.scale.linear().domain(e.x).range([0,this.width]),this.y=d3.scale.linear().domain(e.y).range([this.height,0]),this.y.magnitude=d3.scale.linear().domain([e.y[0]-e.y[0],e.y[1]-e.y[0]]).range([0,this.height])},this.render=function(){this.stackData(),this.discoverRange(),this.renderer.render(),this.updateCallbacks.forEach(function(e){e()})},this.update=this.render,this.stackData=function(){var e=this.series.active().map(function(e){return e.data}).map(function(e){return e.filter(function(e){return this._slice(e)},this)},this),i=this.preserve;i||this.series.forEach(function(e){e.scale&&(i=!0)}),e=i?Rickshaw.clone(e):e,this.series.active().forEach(function(t,i){if(t.scale){var n=e[i];n&&n.forEach(function(e){e.y=t.scale(e.y)})}}),this.stackData.hooks.data.forEach(function(i){e=i.f.apply(t,[e])});var n;if(!this.renderer.unstack){this._validateStackable();var s=d3.layout.stack();s.offset(t.offset),n=s(e)}n=n||e,this.stackData.hooks.after.forEach(function(i){n=i.f.apply(t,[e])});var a=0;return this.series.forEach(function(e){e.disabled||(e.stack=n[a++])}),this.stackedData=n,n},this._validateStackable=function(){var e,t=this.series;t.forEach(function(t){if(e=e||t.data.length,e&&t.data.length!=e)throw"stacked series cannot have differing numbers of points: "+e+" vs "+t.data.length+"; see Rickshaw.Series.fill()"},this)},this.stackData.hooks={data:[],after:[]},this._slice=function(e){if(this.window.xMin||this.window.xMax){var t=!0;return this.window.xMin&&e.x<this.window.xMin&&(t=!1),this.window.xMax&&e.x>this.window.xMax&&(t=!1),t}return!0},this.onUpdate=function(e){this.updateCallbacks.push(e)},this.registerRenderer=function(e){this._renderers=this._renderers||{},this._renderers[e.name]=e},this.configure=function(e){(e.width||e.height)&&this.setSize(e),Rickshaw.keys(this.defaults).forEach(function(t){this[t]=t in e?e[t]:t in this?this[t]:this.defaults[t]},this),this.setRenderer(e.renderer||this.renderer.name,e)},this.setRenderer=function(e,i){if("function"==typeof e)this.renderer=new e({graph:t}),this.registerRenderer(this.renderer);else{if(!this._renderers[e])throw"couldn't find renderer "+e;this.renderer=this._renderers[e]}"object"==typeof i&&this.renderer.configure(i)},this.setSize=function(e){if(e=e||{},void 0!==typeof window)var t=window.getComputedStyle(this.element,null),i=parseInt(t.getPropertyValue("width"),10),n=parseInt(t.getPropertyValue("height"),10);this.width=e.width||i||400,this.height=e.height||n||250,this.vis&&this.vis.attr("width",this.width).attr("height",this.height)},this.initialize(e)},Rickshaw.namespace("Rickshaw.Fixtures.Color"),Rickshaw.Fixtures.Color=function(){this.schemes={},this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse(),this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"],this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"],this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse(),this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"},this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse(),this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"],this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]},Rickshaw.namespace("Rickshaw.Fixtures.RandomData"),Rickshaw.Fixtures.RandomData=function(e){e=e||1;var t=200,i=Math.floor((new Date).getTime()/1e3);this.addData=function(n){var s=100*Math.random()+15+t,a=n[0].length,r=1;n.forEach(function(t){var n=20*Math.random(),h=s/25+r++ +15*(Math.cos(11*a*r/960)+2)+7*(Math.cos(a/7)+2)+1*(Math.cos(a/17)+2);t.push({x:a*e+i,y:h+n})}),t=.85*s},this.removeData=function(t){t.forEach(function(e){e.shift()}),i+=e}},Rickshaw.namespace("Rickshaw.Fixtures.Time"),Rickshaw.Fixtures.Time=function(){60*(new Date).getTimezoneOffset();var e=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(e){return 10*parseInt(e.getUTCFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(e){return e.getUTCFullYear()}},{name:"month",seconds:2635200,formatter:function(t){return e.months[t.getUTCMonth()]}},{name:"week",seconds:604800,formatter:function(t){return e.formatDate(t)}},{name:"day",seconds:86400,formatter:function(e){return e.getUTCDate()}},{name:"6 hour",seconds:21600,formatter:function(t){return e.formatTime(t)}},{name:"hour",seconds:3600,formatter:function(t){return e.formatTime(t)}},{name:"15 minute",seconds:900,formatter:function(t){return e.formatTime(t)}},{name:"minute",seconds:60,formatter:function(e){return e.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(e){return e.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(e){return e.getUTCSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(e){return e.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(e){return e.getUTCMilliseconds()+"ms"}}],this.unit=function(e){return this.units.filter(function(t){return e==t.name}).shift()},this.formatDate=function(e){return d3.time.format("%b %e")(e)},this.formatTime=function(e){return e.toUTCString().match(/(\d+:\d+):/)[1]},this.ceil=function(e,t){var i,n;return"month"==t.name?(i=new Date(1e3*(e+t.seconds-1)),n=new Date(0),n.setUTCFullYear(i.getUTCFullYear()),n.setUTCMonth(i.getUTCMonth()),n.setUTCDate(1),n.setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),n.setUTCMilliseconds(0),n.getTime()/1e3):"year"==t.name?(i=new Date(1e3*(e+t.seconds-1)),n=new Date(0),n.setUTCFullYear(i.getUTCFullYear()),n.setUTCMonth(0),n.setUTCDate(1),n.setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),n.setUTCMilliseconds(0),n.getTime()/1e3):Math.ceil(e/t.seconds)*t.seconds}},Rickshaw.namespace("Rickshaw.Fixtures.Time.Local"),Rickshaw.Fixtures.Time.Local=function(){60*(new Date).getTimezoneOffset();var e=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(e){return 10*parseInt(e.getFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(e){return e.getFullYear()}},{name:"month",seconds:2635200,formatter:function(t){return e.months[t.getMonth()]}},{name:"week",seconds:604800,formatter:function(t){return e.formatDate(t)}},{name:"day",seconds:86400,formatter:function(e){return e.getDate()}},{name:"6 hour",seconds:21600,formatter:function(t){return e.formatTime(t)}},{name:"hour",seconds:3600,formatter:function(t){return e.formatTime(t)}},{name:"15 minute",seconds:900,formatter:function(t){return e.formatTime(t)}},{name:"minute",seconds:60,formatter:function(e){return e.getMinutes()}},{name:"15 second",seconds:15,formatter:function(e){return e.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(e){return e.getSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(e){return e.getMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(e){return e.getMilliseconds()+"ms"}}],this.unit=function(e){return this.units.filter(function(t){return e==t.name}).shift()},this.formatDate=function(e){return d3.time.format("%b %e")(e)},this.formatTime=function(e){return e.toString().match(/(\d+:\d+):/)[1]},this.ceil=function(e,t){var i,n;return"day"==t.name?(i=new Date(1e3*(e+t.seconds-1)),n=new Date(0),n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setDate(i.getDate()),n.setMonth(i.getMonth()),n.setFullYear(i.getFullYear()),n.getTime()/1e3):"month"==t.name?(i=new Date(1e3*(e+t.seconds-1)),n=new Date(0),n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setDate(1),n.setMonth(i.getMonth()),n.setFullYear(i.getFullYear()),n.getTime()/1e3):"year"==t.name?(i=new Date(1e3*(e+t.seconds-1)),n=new Date(0),n.setFullYear(i.getFullYear()),n.setMilliseconds(0),n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setDate(1),n.setMonth(0),n.getTime()/1e3):Math.ceil(e/t.seconds)*t.seconds}},Rickshaw.namespace("Rickshaw.Fixtures.Number"),Rickshaw.Fixtures.Number.formatKMBT=function(e){var t=Math.abs(e);return t>=1e12?e/1e12+"T":t>=1e9?e/1e9+"B":t>=1e6?e/1e6+"M":t>=1e3?e/1e3+"K":1>t&&e>0?e.toFixed(2):0===t?"":e},Rickshaw.Fixtures.Number.formatBase1024KMGTP=function(e){var t=Math.abs(e);return t>=0x4000000000000?e/0x4000000000000+"P":t>=1099511627776?e/1099511627776+"T":t>=1073741824?e/1073741824+"G":t>=1048576?e/1048576+"M":t>=1024?e/1024+"K":1>t&&e>0?e.toFixed(2):0===t?"":e},Rickshaw.namespace("Rickshaw.Color.Palette"),Rickshaw.Color.Palette=function(e){var t=new Rickshaw.Fixtures.Color;if(e=e||{},this.schemes={},this.scheme=t.schemes[e.scheme]||e.scheme||t.schemes.colorwheel,this.runningIndex=0,this.generatorIndex=0,e.interpolatedStopCount){var i,n,s=this.scheme.length-1,a=[];for(i=0;s>i;i++){a.push(this.scheme[i]);var r=d3.interpolateHsl(this.scheme[i],this.scheme[i+1]);for(n=1;n<e.interpolatedStopCount;n++)a.push(r(1/e.interpolatedStopCount*n))}a.push(this.scheme[this.scheme.length-1]),this.scheme=a}this.rotateCount=this.scheme.length,this.color=function(e){return this.scheme[e]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"},this.interpolateColor=function(){if(Array.isArray(this.scheme)){var e;return this.generatorIndex==2*this.rotateCount-1?(e=d3.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(.5),this.generatorIndex=0,this.rotateCount*=2):(e=d3.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(.5),this.generatorIndex++),this.scheme.push(e),e}}},Rickshaw.namespace("Rickshaw.Graph.Ajax"),Rickshaw.Graph.Ajax=Rickshaw.Class.create({initialize:function(e){this.dataURL=e.dataURL,this.onData=e.onData||function(e){return e},this.onComplete=e.onComplete||function(){},this.onError=e.onError||function(){},this.args=e,this.request()},request:function(){$.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL),this.onError(this)},success:function(e){e=this.onData(e),this.args.series=this._splice({data:e,series:this.args.series}),this.graph=this.graph||new Rickshaw.Graph(this.args),this.graph.render(),this.onComplete(this)},_splice:function(e){var t=e.data,i=e.series;return e.series?(i.forEach(function(e){var i=e.key||e.name;if(!i)throw"series needs a key or a name";t.forEach(function(t){var n=t.key||t.name;if(!n)throw"data needs a key or a name";if(i==n){var s=["color","name","data"];s.forEach(function(i){t[i]&&(e[i]=t[i])})}})}),i):t}}),Rickshaw.namespace("Rickshaw.Graph.Annotate"),Rickshaw.Graph.Annotate=function(e){this.graph=e.graph,this.elements={timeline:e.element};var t=this;this.data={},this.elements.timeline.classList.add("rickshaw_annotation_timeline"),this.add=function(e,i,n){t.data[e]=t.data[e]||{boxes:[]},t.data[e].boxes.push({content:i,end:n})},this.update=function(){Rickshaw.keys(t.data).forEach(function(e){var i=t.data[e],n=t.graph.x(e);if(0>n||n>t.graph.x.range()[1])return i.element&&(i.line.classList.add("offscreen"),i.element.style.display="none"),i.boxes.forEach(function(e){e.rangeElement&&e.rangeElement.classList.add("offscreen")}),void 0;if(!i.element){var s=i.element=document.createElement("div");s.classList.add("annotation"),this.elements.timeline.appendChild(s),s.addEventListener("click",function(){s.classList.toggle("active"),i.line.classList.toggle("active"),i.boxes.forEach(function(e){e.rangeElement&&e.rangeElement.classList.toggle("active")})},!1)}i.element.style.left=n+"px",i.element.style.display="block",i.boxes.forEach(function(e){var s=e.element;if(s||(s=e.element=document.createElement("div"),s.classList.add("content"),s.innerHTML=e.content,i.element.appendChild(s),i.line=document.createElement("div"),i.line.classList.add("annotation_line"),t.graph.element.appendChild(i.line),e.end&&(e.rangeElement=document.createElement("div"),e.rangeElement.classList.add("annotation_range"),t.graph.element.appendChild(e.rangeElement))),e.end){var a=n,r=Math.min(t.graph.x(e.end),t.graph.x.range()[1]);a>r&&(r=n,a=Math.max(t.graph.x(e.end),t.graph.x.range()[0]));var h=r-a;e.rangeElement.style.left=a+"px",e.rangeElement.style.width=h+"px",e.rangeElement.classList.remove("offscreen")}i.line.classList.remove("offscreen"),i.line.style.left=n+"px"})},this)},this.graph.onUpdate(function(){t.update()})},Rickshaw.namespace("Rickshaw.Graph.Axis.Time"),Rickshaw.Graph.Axis.Time=function(e){var t=this;this.graph=e.graph,this.elements=[],this.ticksTreatment=e.ticksTreatment||"plain",this.fixedTimeUnit=e.timeUnit;var i=e.timeFixture||new Rickshaw.Fixtures.Time;this.appropriateTimeUnit=function(){var e,t=i.units,n=this.graph.x.domain(),s=n[1]-n[0];return t.forEach(function(t){Math.floor(s/t.seconds)>=2&&(e=e||t)}),e||i.units[i.units.length-1]},this.tickOffsets=function(){for(var e=this.graph.x.domain(),t=this.fixedTimeUnit||this.appropriateTimeUnit(),n=Math.ceil((e[1]-e[0])/t.seconds),s=e[0],a=[],r=0;n>r;r++){var h=i.ceil(s,t);s=h+t.seconds/2,a.push({value:h,unit:t})}return a},this.render=function(){this.elements.forEach(function(e){e.parentNode.removeChild(e)}),this.elements=[];var e=this.tickOffsets();e.forEach(function(e){if(!(t.graph.x(e.value)>t.graph.x.range()[1])){var i=document.createElement("div");i.style.left=t.graph.x(e.value)+"px",i.classList.add("x_tick"),i.classList.add(t.ticksTreatment);var n=document.createElement("div");n.classList.add("title"),n.innerHTML=e.unit.formatter(new Date(1e3*e.value)),i.appendChild(n),t.graph.element.appendChild(i),t.elements.push(i)}})},this.graph.onUpdate(function(){t.render()})},Rickshaw.namespace("Rickshaw.Graph.Axis.X"),Rickshaw.Graph.Axis.X=function(e){var t=this,i=.1;this.initialize=function(e){this.graph=e.graph,this.orientation=e.orientation||"top",this.pixelsPerTick=e.pixelsPerTick||75,e.ticks&&(this.staticTicks=e.ticks),e.tickValues&&(this.tickValues=e.tickValues),this.tickSize=e.tickSize||4,this.ticksTreatment=e.ticksTreatment||"plain",e.element?(this.element=e.element,this._discoverSize(e.element,e),this.vis=d3.select(e.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:e.width,height:e.height})):this.vis=this.graph.vis,this.graph.onUpdate(function(){t.render()})},this.setSize=function(e){if(e=e||{},this.element){this._discoverSize(this.element.parentNode,e),this.vis.attr("height",this.height).attr("width",this.width*(1+i));var t=Math.floor(this.width*i/2);this.element.style.left=-1*t+"px"}},this.render=function(){void 0!==this._renderWidth&&this.graph.width!==this._renderWidth&&this.setSize({auto:!0});var t=d3.svg.axis().scale(this.graph.x).orient(this.orientation);t.tickFormat(e.tickFormat||function(e){return e}),this.tickValues&&t.tickValues(this.tickValues),this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var n,s=Math.floor(this.width*i/2)||0;if("top"==this.orientation){var a=this.height||this.graph.height;n="translate("+s+","+a+")"}else n="translate("+s+", 0)";this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",n).call(t.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var r=("bottom"==this.orientation?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(t.ticks(this.ticks).tickSubdivide(0).tickSize(r)),this._renderHeight=this.graph.height},this._discoverSize=function(e,t){if("undefined"!=typeof window){var n=window.getComputedStyle(e,null),s=parseInt(n.getPropertyValue("height"),10);if(!t.auto)var a=parseInt(n.getPropertyValue("width"),10)}this.width=(t.width||a||this.graph.width)*(1+i),this.height=t.height||s||40},this.initialize(e)},Rickshaw.namespace("Rickshaw.Graph.Axis.Y"),Rickshaw.Graph.Axis.Y=Rickshaw.Class.create({initialize:function(e){this.graph=e.graph,this.orientation=e.orientation||"right",this.pixelsPerTick=e.pixelsPerTick||75,e.ticks&&(this.staticTicks=e.ticks),e.tickValues&&(this.tickValues=e.tickValues),this.tickSize=e.tickSize||4,this.ticksTreatment=e.ticksTreatment||"plain",this.tickFormat=e.tickFormat||function(e){return e},this.berthRate=.1,e.element?(this.element=e.element,this.vis=d3.select(e.element).append("svg:svg").attr("class","rickshaw_graph y_axis"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:e.width,height:e.height})):this.vis=this.graph.vis;var t=this;this.graph.onUpdate(function(){t.render()})},setSize:function(e){if(e=e||{},this.element){if("undefined"!=typeof window){var t=window.getComputedStyle(this.element.parentNode,null),i=parseInt(t.getPropertyValue("width"),10);if(!e.auto)var n=parseInt(t.getPropertyValue("height"),10)}this.width=e.width||i||this.graph.width*this.berthRate,this.height=e.height||n||this.graph.height,this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var s=this.height*this.berthRate;"left"==this.orientation&&(this.element.style.top=-1*s+"px")}},render:function(){void 0!==this._renderHeight&&this.graph.height!==this._renderHeight&&this.setSize({auto:!0}),this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var e=this._drawAxis(this.graph.y);this._drawGrid(e),this._renderHeight=this.graph.height},_drawAxis:function(e){var t=d3.svg.axis().scale(e).orient(this.orientation);if(t.tickFormat(this.tickFormat),this.tickValues&&t.tickValues(this.tickValues),"left"==this.orientation)var i=this.height*this.berthRate,n="translate("+this.width+", "+i+")";return this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",n).call(t.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize)),t},_drawGrid:function(e){var t=("right"==this.orientation?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(e.ticks(this.ticks).tickSubdivide(0).tickSize(t))}}),Rickshaw.namespace("Rickshaw.Graph.Axis.Y.Scaled"),Rickshaw.Graph.Axis.Y.Scaled=Rickshaw.Class.create(Rickshaw.Graph.Axis.Y,{initialize:function($super,e){if("undefined"==typeof e.scale)throw new Error("Scaled requires scale");this.scale=e.scale,this.grid="undefined"==typeof e.grid?!0:e.grid,$super(e)},_drawAxis:function($super,e){var t=this.scale.domain(),i=this.graph.renderer.domain().y,n=[Math.min.apply(Math,t),Math.max.apply(Math,t)],s=d3.scale.linear().domain([0,1]).range(n),a=[s(i[0]),s(i[1])],r=d3.scale.linear().domain(n).range(a),h=this.scale.copy().domain(t.map(r)).range(e.range());return $super(h)},_drawGrid:function($super,e){this.grid&&$super(e)}}),Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Highlight"),Rickshaw.Graph.Behavior.Series.Highlight=function(e){this.graph=e.graph,this.legend=e.legend;var t=this,i={},n=null,s=e.disabledColor||function(e){return d3.interpolateRgb(e,d3.rgb("#d8d8d8"))(.8).toString()};this.addHighlightEvents=function(e){e.element.addEventListener("mouseover",function(){n||(n=e,t.legend.lines.forEach(function(n){if(e!==n)i[n.series.name]=i[n.series.name]||n.series.color,n.series.color=s(n.series.color);else if(t.graph.renderer.unstack&&(n.series.renderer?n.series.renderer.unstack:!0)){var a=t.graph.series.indexOf(n.series);n.originalIndex=a;var r=t.graph.series.splice(a,1)[0];t.graph.series.push(r)}}),t.graph.update())},!1),e.element.addEventListener("mouseout",function(){n&&(n=null,t.legend.lines.forEach(function(n){if(e===n&&n.hasOwnProperty("originalIndex")){var s=t.graph.series.pop();t.graph.series.splice(n.originalIndex,0,s),delete n.originalIndex}i[n.series.name]&&(n.series.color=i[n.series.name])}),t.graph.update())},!1)},this.legend&&this.legend.lines.forEach(function(e){t.addHighlightEvents(e)})},Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Order"),Rickshaw.Graph.Behavior.Series.Order=function(e){this.graph=e.graph,this.legend=e.legend;var t=this;if("undefined"==typeof window.$)throw"couldn't find jQuery at window.$";if("undefined"==typeof window.$.ui)throw"couldn't find jQuery UI at window.$.ui";$(function(){$(t.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(){var e=[];$(t.legend.list).find("li").each(function(t,i){i.series&&e.push(i.series)});for(var i=t.graph.series.length-1;i>=0;i--)t.graph.series[i]=e.shift();t.graph.update()}}),$(t.legend.list).disableSelection()}),this.graph.onUpdate(function(){var e=window.getComputedStyle(t.legend.element).height;t.legend.element.style.height=e})},Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Toggle"),Rickshaw.Graph.Behavior.Series.Toggle=function(e){this.graph=e.graph,this.legend=e.legend;var t=this;this.addAnchor=function(e){var i=document.createElement("a");i.innerHTML="&#10004;",i.classList.add("action"),e.element.insertBefore(i,e.element.firstChild),i.onclick=function(){if(e.series.disabled)e.series.enable(),e.element.classList.remove("disabled");else{if(this.graph.series.filter(function(e){return!e.disabled}).length<=1)return;e.series.disable(),e.element.classList.add("disabled")}}.bind(this);var n=e.element.getElementsByTagName("span")[0];n.onclick=function(){var i=e.series.disabled;if(!i)for(var n=0;n<t.legend.lines.length;n++){var s=t.legend.lines[n];if(e.series===s.series);else if(!s.series.disabled){i=!0;break}}i?(e.series.enable(),e.element.classList.remove("disabled"),t.legend.lines.forEach(function(t){e.series===t.series||(t.series.disable(),t.element.classList.add("disabled"))})):t.legend.lines.forEach(function(e){e.series.enable(),e.element.classList.remove("disabled")})}},this.legend&&("undefined"!=typeof $&&$(this.legend.list).sortable&&$(this.legend.list).sortable({start:function(e,t){t.item.bind("no.onclick",function(e){e.preventDefault()})},stop:function(e,t){setTimeout(function(){t.item.unbind("no.onclick")},250)}}),this.legend.lines.forEach(function(e){t.addAnchor(e)})),this._addBehavior=function(){this.graph.series.forEach(function(e){e.disable=function(){if(t.graph.series.length<=1)throw"only one series left";e.disabled=!0,t.graph.update()},e.enable=function(){e.disabled=!1,t.graph.update()}})},this._addBehavior(),this.updateBehaviour=function(){this._addBehavior()}},Rickshaw.namespace("Rickshaw.Graph.HoverDetail"),Rickshaw.Graph.HoverDetail=Rickshaw.Class.create({initialize:function(e){var t=this.graph=e.graph;this.xFormatter=e.xFormatter||function(e){return new Date(1e3*e).toUTCString()},this.yFormatter=e.yFormatter||function(e){return null===e?e:e.toFixed(2)};var i=this.element=document.createElement("div");i.className="detail",this.visible=!0,t.element.appendChild(i),this.lastEvent=null,this._addListeners(),this.onShow=e.onShow,this.onHide=e.onHide,this.onRender=e.onRender,this.formatter=e.formatter||this.formatter},formatter:function(e,t,i,n,s){return e.name+":&nbsp;"+s},update:function(e){if(e=e||this.lastEvent,e&&(this.lastEvent=e,e.target.nodeName.match(/^(path|svg|rect|circle)$/))){var t,i=this.graph,n=e.offsetX||e.layerX,s=e.offsetY||e.layerY,a=0,r=[];if(this.graph.series.active().forEach(function(e){var h=this.graph.stackedData[a++];if(h.length){var o=i.x.invert(n),c=d3.scale.linear().domain([h[0].x,h.slice(-1)[0].x]).range([0,h.length-1]),l=Math.round(c(o));l==h.length-1&&l--;for(var d=Math.min(l||0,h.length-1),u=l;u<h.length-1&&h[u]&&h[u+1];){if(h[u].x<=o&&h[u+1].x>o){d=Math.abs(o-h[u].x)<Math.abs(o-h[u+1].x)?u:u+1;break}h[u+1].x<=o?u++:u--}0>d&&(d=0);var f=h[d],p=Math.sqrt(Math.pow(Math.abs(i.x(f.x)-n),2)+Math.pow(Math.abs(i.y(f.y+f.y0)-s),2)),m=e.xFormatter||this.xFormatter,g=e.yFormatter||this.yFormatter,v={formattedXValue:m(f.x),formattedYValue:g(e.scale?e.scale.invert(f.y):f.y),series:e,value:f,distance:p,order:a,name:e.name};(!t||p<t.distance)&&(t=v),r.push(v)}},this),t){t.active=!0;var h=t.value.x,o=t.formattedXValue;this.element.innerHTML="",this.element.style.left=i.x(h)+"px",this.visible&&this.render({points:r,detail:r,mouseX:n,mouseY:s,formattedXValue:o,domainX:h})}}},hide:function(){this.visible=!1,this.element.classList.add("inactive"),"function"==typeof this.onHide&&this.onHide()},show:function(){this.visible=!0,this.element.classList.remove("inactive"),"function"==typeof this.onShow&&this.onShow()},render:function(e){var t=this.graph,i=e.points,n=i.filter(function(e){return e.active}).shift();if(null!==n.value.y){var s=n.formattedXValue,a=n.formattedYValue;this.element.innerHTML="",this.element.style.left=t.x(n.value.x)+"px";var r=document.createElement("div");r.className="x_label",r.innerHTML=s,this.element.appendChild(r);var h=document.createElement("div");h.className="item";var o=n.series,c=o.scale?o.scale.invert(n.value.y):n.value.y;h.innerHTML=this.formatter(o,n.value.x,c,s,a,n),h.style.top=this.graph.y(n.value.y0+n.value.y)+"px",this.element.appendChild(h);var l=document.createElement("div");l.className="dot",l.style.top=h.style.top,l.style.borderColor=o.color,this.element.appendChild(l),n.active&&(h.classList.add("active"),l.classList.add("active"));var d=[r,h];d.forEach(function(e){e.classList.add("left")}),this.show();var u=this._calcLayoutError(d);if(u>0){d.forEach(function(e){e.classList.remove("left"),e.classList.add("right")});var f=this._calcLayoutError(d);f>u&&d.forEach(function(e){e.classList.remove("right"),e.classList.add("left")})}"function"==typeof this.onRender&&this.onRender(e)}},_calcLayoutError:function(e){var t=this.element.parentNode.getBoundingClientRect(),i=0;return e.forEach(function(e){var n=e.getBoundingClientRect();n.width&&(n.right>t.right&&(i+=n.right-t.right),n.left<t.left&&(i+=t.left-n.left))}),i},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(e){this.visible=!0,this.update(e)}.bind(this),!1),this.graph.onUpdate(function(){this.update()}.bind(this)),this.graph.element.addEventListener("mouseout",function(e){!e.relatedTarget||e.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS||this.hide()
}.bind(this),!1)}}),Rickshaw.namespace("Rickshaw.Graph.JSONP"),Rickshaw.Graph.JSONP=Rickshaw.Class.create(Rickshaw.Graph.Ajax,{request:function(){$.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}}),Rickshaw.namespace("Rickshaw.Graph.Legend"),Rickshaw.Graph.Legend=Rickshaw.Class.create({className:"rickshaw_legend",initialize:function(e){this.element=e.element,this.graph=e.graph,this.naturalOrder=e.naturalOrder,this.element.classList.add(this.className),this.list=document.createElement("ul"),this.element.appendChild(this.list),this.render(),this.graph.onUpdate(function(){})},render:function(){for(var e=this;this.list.firstChild;)this.list.removeChild(this.list.firstChild);this.lines=[];var t=this.graph.series.map(function(e){return e});this.naturalOrder||(t=t.reverse()),t.forEach(function(t){e.addLine(t)})},addLine:function(e){var t=document.createElement("li");t.className="line",e.disabled&&(t.className+=" disabled");var i=document.createElement("div");i.className="swatch",i.style.backgroundColor=e.color,t.appendChild(i);var n=document.createElement("span");n.className="label",n.innerHTML=e.name,t.appendChild(n),this.list.appendChild(t),t.series=e,e.noLegend&&(t.style.display="none");var s={element:t,series:e};return this.shelving&&(this.shelving.addAnchor(s),this.shelving.updateBehaviour()),this.highlighter&&this.highlighter.addHighlightEvents(s),this.lines.push(s),t}}),Rickshaw.namespace("Rickshaw.Graph.RangeSlider"),Rickshaw.Graph.RangeSlider=Rickshaw.Class.create({initialize:function(e){this.element=e.element;var t=this.graph=e.graph;this.build(),t.onUpdate(function(){this.update()}.bind(this))},build:function(){var e=this.element,t=this.graph,i=t.dataDomain();$(function(){$(e).slider({range:!0,min:i[0],max:i[1],values:[i[0],i[1]],slide:function(e,i){if(!(i.values[1]<=i.values[0])){t.window.xMin=i.values[0],t.window.xMax=i.values[1],t.update();var n=t.dataDomain();n[0]==i.values[0]&&(t.window.xMin=void 0),n[1]==i.values[1]&&(t.window.xMax=void 0)}}})}),$(e)[0].style.width=t.width+"px"},update:function(){var e=this.element,t=this.graph,i=$(e).slider("option","values"),n=t.dataDomain();$(e).slider("option","min",n[0]),$(e).slider("option","max",n[1]),null==t.window.xMin&&(i[0]=n[0]),null==t.window.xMax&&(i[1]=n[1]),$(e).slider("option","values",i)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer"),Rickshaw.Graph.Renderer=Rickshaw.Class.create({initialize:function(e){this.graph=e.graph,this.tension=e.tension||this.tension,this.graph.unstacker=this.graph.unstacker||new Rickshaw.Graph.Unstacker({graph:this.graph}),this.configure(e)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:.8,strokeWidth:2,unstack:!0,padding:{top:.01,right:0,bottom:.01,left:0},stroke:!1,fill:!1}},domain:function(e){var t=e||this.graph.stackedData||this.graph.stackData(),i=t[0][0];if(void 0===i)return{x:[null,null],y:[null,null]};var n=i.x,s=i.x,a=i.y+i.y0,r=i.y+i.y0;return t.forEach(function(e){e.forEach(function(e){if(null!=e.y){var t=e.y+e.y0;a>t&&(a=t),t>r&&(r=t)}}),e.length&&(e[0].x<n&&(n=e[0].x),e[e.length-1].x>s&&(s=e[e.length-1].x))}),n-=(s-n)*this.padding.left,s+=(s-n)*this.padding.right,a="auto"===this.graph.min?a:this.graph.min||0,r=void 0===this.graph.max?r:this.graph.max,("auto"===this.graph.min||0>a)&&(a-=(r-a)*this.padding.bottom),void 0===this.graph.max&&(r+=(r-a)*this.padding.top),{x:[n,s],y:[a,r]}},render:function(e){e=e||{};var t=this.graph,i=e.series||t.series,n=e.vis||t.vis;n.selectAll("*").remove();var s=i.filter(function(e){return!e.disabled}).map(function(e){return e.stack}),a=n.selectAll("path").data(s).enter().append("svg:path").attr("d",this.seriesPathFactory()),r=0;i.forEach(function(e){e.disabled||(e.path=a[0][r++],this._styleSeries(e))},this)},_styleSeries:function(e){var t=this.fill?e.color:"none",i=this.stroke?e.color:"none";e.path.setAttribute("fill",t),e.path.setAttribute("stroke",i),e.path.setAttribute("stroke-width",this.strokeWidth),e.path.setAttribute("class",e.className)},configure:function(e){e=e||{},Rickshaw.keys(this.defaults()).forEach(function(t){return e.hasOwnProperty(t)?("object"==typeof this.defaults()[t]?Rickshaw.keys(this.defaults()[t]).forEach(function(i){this[t][i]=void 0!==e[t][i]?e[t][i]:void 0!==this[t][i]?this[t][i]:this.defaults()[t][i]},this):this[t]=void 0!==e[t]?e[t]:void 0!==this[t]?this[t]:void 0!==this.graph[t]?this.graph[t]:this.defaults()[t],void 0):(this[t]=this[t]||this.graph[t]||this.defaults()[t],void 0)},this)},setStrokeWidth:function(e){void 0!==e&&(this.strokeWidth=e)},setTension:function(e){void 0!==e&&(this.tension=e)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Line"),Rickshaw.Graph.Renderer.Line=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"line",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0})},seriesPathFactory:function(){var e=this.graph,t=d3.svg.line().x(function(t){return e.x(t.x)}).y(function(t){return e.y(t.y)}).interpolate(this.graph.interpolation).tension(this.tension);return t.defined&&t.defined(function(e){return null!==e.y}),t}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Stack"),Rickshaw.Graph.Renderer.Stack=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"stack",defaults:function($super){return Rickshaw.extend($super(),{fill:!0,stroke:!1,unstack:!1})},seriesPathFactory:function(){var e=this.graph,t=d3.svg.area().x(function(t){return e.x(t.x)}).y0(function(t){return e.y(t.y0)}).y1(function(t){return e.y(t.y+t.y0)}).interpolate(this.graph.interpolation).tension(this.tension);return t.defined&&t.defined(function(e){return null!==e.y}),t}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Bar"),Rickshaw.Graph.Renderer.Bar=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"bar",defaults:function($super){var e=Rickshaw.extend($super(),{gapSize:.05,unstack:!1});return delete e.tension,e},initialize:function($super,e){e=e||{},this.gapSize=e.gapSize||this.gapSize,$super(e)},domain:function($super){var e=$super(),t=this._frequentInterval(this.graph.stackedData.slice(-1).shift());return e.x[1]+=Number(t.magnitude),e},barWidth:function(e){var t=this._frequentInterval(e.stack),i=this.graph.x(e.stack[0].x+t.magnitude*(1-this.gapSize));return i},render:function(e){e=e||{};var t=this.graph,i=e.series||t.series,n=e.vis||t.vis;n.selectAll("*").remove();var s=this.barWidth(i.active()[0]),a=0,r=i.filter(function(e){return!e.disabled}).length,h=this.unstack?s/r:s,o=function(e){var i=[1,0,0,e.y<0?-1:1,0,e.y<0?2*t.y.magnitude(Math.abs(e.y)):0];return"matrix("+i.join(",")+")"};i.forEach(function(e){if(!e.disabled){this.barWidth(e);var i=n.selectAll("path").data(e.stack.filter(function(e){return null!==e.y})).enter().append("svg:rect").attr("x",function(e){return t.x(e.x)+a}).attr("y",function(e){return t.y(e.y0+Math.abs(e.y))*(e.y<0?-1:1)}).attr("width",h).attr("height",function(e){return t.y.magnitude(Math.abs(e.y))}).attr("transform",o);Array.prototype.forEach.call(i[0],function(t){t.setAttribute("fill",e.color)}),this.unstack&&(a+=h)}},this)},_frequentInterval:function(e){for(var t={},i=0;i<e.length-1;i++){var n=e[i+1].x-e[i].x;t[n]=t[n]||0,t[n]++}var s={count:0,magnitude:1};return Rickshaw.keys(t).forEach(function(e){s.count<t[e]&&(s={count:t[e],magnitude:e})}),s}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Area"),Rickshaw.Graph.Renderer.Area=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"area",defaults:function($super){return Rickshaw.extend($super(),{unstack:!1,fill:!1,stroke:!1})},seriesPathFactory:function(){var e=this.graph,t=d3.svg.area().x(function(t){return e.x(t.x)}).y0(function(t){return e.y(t.y0)}).y1(function(t){return e.y(t.y+t.y0)}).interpolate(e.interpolation).tension(this.tension);return t.defined&&t.defined(function(e){return null!==e.y}),t},seriesStrokeFactory:function(){var e=this.graph,t=d3.svg.line().x(function(t){return e.x(t.x)}).y(function(t){return e.y(t.y+t.y0)}).interpolate(e.interpolation).tension(this.tension);return t.defined&&t.defined(function(e){return null!==e.y}),t},render:function(e){e=e||{};var t=this.graph,i=e.series||t.series,n=e.vis||t.vis;n.selectAll("*").remove();var s=this.unstack?"append":"insert",a=i.filter(function(e){return!e.disabled}).map(function(e){return e.stack}),r=n.selectAll("path").data(a).enter()[s]("svg:g","g");r.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area"),this.stroke&&r.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line");var h=0;i.forEach(function(e){e.disabled||(e.path=r[0][h++],this._styleSeries(e))},this)},_styleSeries:function(e){e.path&&(d3.select(e.path).select(".area").attr("fill",e.color),this.stroke&&d3.select(e.path).select(".line").attr("fill","none").attr("stroke",e.stroke||d3.interpolateRgb(e.color,"black")(.125)).attr("stroke-width",this.strokeWidth),e.className&&e.path.setAttribute("class",e.className))}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.ScatterPlot"),Rickshaw.Graph.Renderer.ScatterPlot=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"scatterplot",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!0,stroke:!1,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:4})},initialize:function($super,e){$super(e)},render:function(e){e=e||{};var t=this.graph,i=e.series||t.series,n=e.vis||t.vis,s=this.dotSize;n.selectAll("*").remove(),i.forEach(function(e){if(!e.disabled){var i=n.selectAll("path").data(e.stack.filter(function(e){return null!==e.y})).enter().append("svg:circle").attr("cx",function(e){return t.x(e.x)}).attr("cy",function(e){return t.y(e.y)}).attr("r",function(e){return"r"in e?e.r:s});Array.prototype.forEach.call(i[0],function(t){t.setAttribute("fill",e.color)})}},this)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Multi"),Rickshaw.Graph.Renderer.Multi=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"multi",initialize:function($super,e){$super(e)},defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0})},configure:function($super,e){e=e||{},this.config=e,$super(e)},domain:function($super){this.graph.stackData();var e=[],t=this._groups();this._stack(t),t.forEach(function(t){var i=t.series.filter(function(e){return!e.disabled}).map(function(e){return e.stack});if(i.length){var n=$super(i);e.push(n)}});var i=d3.min(e.map(function(e){return e.x[0]})),n=d3.max(e.map(function(e){return e.x[1]})),s=d3.min(e.map(function(e){return e.y[0]})),a=d3.max(e.map(function(e){return e.y[1]}));return{x:[i,n],y:[s,a]}},_groups:function(){var e=this.graph,t={};e.series.forEach(function(i){if(!i.disabled){if(!t[i.renderer]){var n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"g");e.vis[0][0].appendChild(s);var a=e._renderers[i.renderer],r={},h=[this.defaults(),a.defaults(),this.config,this.graph];h.forEach(function(e){Rickshaw.extend(r,e)}),a.configure(r),t[i.renderer]={renderer:a,series:[],vis:d3.select(s)}}t[i.renderer].series.push(i)}},this);var i=[];return Object.keys(t).forEach(function(e){var n=t[e];i.push(n)}),i},_stack:function(e){return e.forEach(function(e){var t=e.series.filter(function(e){return!e.disabled}),i=t.map(function(e){return e.stack});if(!e.renderer.unstack){var n=d3.layout.stack(),s=Rickshaw.clone(n(i));t.forEach(function(e,t){e._stack=Rickshaw.clone(s[t])})}},this),e},render:function(){this.graph.series.forEach(function(e){if(!e.renderer)throw new Error("Each series needs a renderer for graph 'multi' renderer")}),this.graph.vis.selectAll("*").remove();var e=this._groups();e=this._stack(e),e.forEach(function(e){var t=e.series.filter(function(e){return!e.disabled});t.active=function(){return t},e.renderer.render({series:t,vis:e.vis}),t.forEach(function(e){e.stack=e._stack||e.stack||e.data})})}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.LinePlot"),Rickshaw.Graph.Renderer.LinePlot=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"lineplot",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:3,strokeWidth:2})},initialize:function($super,e){$super(e)},seriesPathFactory:function(){var e=this.graph,t=d3.svg.line().x(function(t){return e.x(t.x)}).y(function(t){return e.y(t.y)}).interpolate(this.graph.interpolation).tension(this.tension);return t.defined&&t.defined(function(e){return null!==e.y}),t},_renderDots:function(){var e=this.graph;e.series.forEach(function(t){if(!t.disabled){var i=e.vis.selectAll("x").data(t.stack.filter(function(e){return null!==e.y})).enter().append("svg:circle").attr("cx",function(t){return e.x(t.x)}).attr("cy",function(t){return e.y(t.y)}).attr("r",function(t){return"r"in t?t.r:e.renderer.dotSize});Array.prototype.forEach.call(i[0],function(e){e&&(e.setAttribute("data-color",t.color),e.setAttribute("fill","white"),e.setAttribute("stroke",t.color),e.setAttribute("stroke-width",this.strokeWidth))}.bind(this))}},this)},_renderLines:function(){var e=this.graph,t=e.vis.selectAll("path").data(this.graph.stackedData).enter().append("svg:path").attr("d",this.seriesPathFactory()),i=0;e.series.forEach(function(e){e.disabled||(e.path=t[0][i++],this._styleSeries(e))},this)},render:function(){var e=this.graph;e.vis.selectAll("*").remove(),this._renderLines(),this._renderDots()}}),Rickshaw.namespace("Rickshaw.Graph.Smoother"),Rickshaw.Graph.Smoother=Rickshaw.Class.create({initialize:function(e){this.graph=e.graph,this.element=e.element,this.aggregationScale=1,this.build(),this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var e=this;this.element&&$(function(){$(e.element).slider({min:1,max:100,slide:function(t,i){e.setScale(i.value),e.graph.update()}})})},setScale:function(e){if(1>e)throw"scale out of range: "+e;this.aggregationScale=e,this.graph.update()},transformer:function(e){if(1==this.aggregationScale)return e;var t=[];return e.forEach(function(e){for(var i=[];e.length;){var n=0,s=0,a=e.splice(0,this.aggregationScale);a.forEach(function(e){n+=e.x/a.length,s+=e.y/a.length}),i.push({x:n,y:s})}t.push(i)}.bind(this)),t}}),Rickshaw.namespace("Rickshaw.Graph.Socketio"),Rickshaw.Graph.Socketio=Rickshaw.Class.create(Rickshaw.Graph.Ajax,{request:function(){var e=io.connect(this.dataURL);thisData=this,e.on("rickshaw",function(e){thisData.success(e)})}}),Rickshaw.namespace("Rickshaw.Graph.Unstacker"),Rickshaw.Graph.Unstacker=function(e){this.graph=e.graph;var t=this;this.graph.stackData.hooks.after.push({name:"unstacker",f:function(e){return t.graph.renderer.unstack?(e.forEach(function(e){e.forEach(function(e){e.y0=0})}),e):e}})},Rickshaw.namespace("Rickshaw.Series"),Rickshaw.Series=Rickshaw.Class.create(Array,{initialize:function(e,t,i){i=i||{},this.palette=new Rickshaw.Color.Palette(t),this.timeBase="undefined"==typeof i.timeBase?Math.floor((new Date).getTime()/1e3):i.timeBase;var n="undefined"==typeof i.timeInterval?1e3:i.timeInterval;this.setTimeInterval(n),e&&"object"==typeof e&&Array.isArray(e)&&e.forEach(function(e){this.addItem(e)},this)},addItem:function(e){if("undefined"==typeof e.name)throw"addItem() needs a name";e.color=e.color||this.palette.color(e.name),e.data=e.data||[],0===e.data.length&&this.length&&this.getIndex()>0?this[0].data.forEach(function(t){e.data.push({x:t.x,y:0})}):0===e.data.length&&e.data.push({x:this.timeBase-(this.timeInterval||0),y:0}),this.push(e),this.legend&&this.legend.addLine(this.itemByName(e.name))},addData:function(e,t){var i=this.getIndex();Rickshaw.keys(e).forEach(function(e){this.itemByName(e)||this.addItem({name:e})},this),this.forEach(function(n){n.data.push({x:t||(i*this.timeInterval||1)+this.timeBase,y:e[n.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(e){for(var t=0;t<this.length;t++)if(this[t].name==e)return this[t]},setTimeInterval:function(e){this.timeInterval=e/1e3},setTimeBase:function(e){this.timeBase=e},dump:function(){var e={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};return this.forEach(function(t){var i={color:t.color,name:t.name,data:[]};t.data.forEach(function(e){i.data.push({x:e.x,y:e.y})}),e.items.push(i)}),e},load:function(e){e.timeInterval&&(this.timeInterval=e.timeInterval),e.timeBase&&(this.timeBase=e.timeBase),e.items&&e.items.forEach(function(e){this.push(e),this.legend&&this.legend.addLine(this.itemByName(e.name))},this)}}),Rickshaw.Series.zeroFill=function(e){Rickshaw.Series.fill(e,0)},Rickshaw.Series.fill=function(e,t){for(var i,n=0,s=e.map(function(e){return e.data});n<Math.max.apply(null,s.map(function(e){return e.length}));)i=Math.min.apply(null,s.filter(function(e){return e[n]}).map(function(e){return e[n].x})),s.forEach(function(e){e[n]&&e[n].x==i||e.splice(n,0,{x:i,y:t})}),n++},Rickshaw.namespace("Rickshaw.Series.FixedDuration"),Rickshaw.Series.FixedDuration=Rickshaw.Class.create(Rickshaw.Series,{initialize:function(e,t,i){if(i=i||{},"undefined"==typeof i.timeInterval)throw new Error("FixedDuration series requires timeInterval");if("undefined"==typeof i.maxDataPoints)throw new Error("FixedDuration series requires maxDataPoints");if(this.palette=new Rickshaw.Color.Palette(t),this.timeBase="undefined"==typeof i.timeBase?Math.floor((new Date).getTime()/1e3):i.timeBase,this.setTimeInterval(i.timeInterval),this[0]&&this[0].data&&this[0].data.length?(this.currentSize=this[0].data.length,this.currentIndex=this[0].data.length):(this.currentSize=0,this.currentIndex=0),this.maxDataPoints=i.maxDataPoints,e&&"object"==typeof e&&Array.isArray(e)&&(e.forEach(function(e){this.addItem(e)},this),this.currentSize+=1,this.currentIndex+=1),this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval,"undefined"!=typeof this.maxDataPoints&&this.currentSize<this.maxDataPoints)for(var n=this.maxDataPoints-this.currentSize-1;n>1;n--)this.currentSize+=1,this.currentIndex+=1,this.forEach(function(e){e.data.unshift({x:((n-1)*this.timeInterval||1)+this.timeBase,y:0,i:n})},this)},addData:function($super,e,t){if($super(e,t),this.currentSize+=1,this.currentIndex+=1,void 0!==this.maxDataPoints)for(;this.currentSize>this.maxDataPoints;)this.dropData()},dropData:function(){this.forEach(function(e){e.data.splice(0,1)}),this.currentSize-=1},getIndex:function(){return this.currentIndex}});
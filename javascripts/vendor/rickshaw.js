var Rickshaw={namespace:function(t){for(var n=t.split("."),e=Rickshaw,r=1,i=n.length;i>r;r++){var a=n[r];e[a]=e[a]||{},e=e[a]}return e},keys:function(t){var n=[];for(var e in t)n.push(e);return n},extend:function(t,n){for(var e in n)t[e]=n[e];return t},clone:function(t){return JSON.parse(JSON.stringify(t))}};if("undefined"!=typeof module&&module.exports){var d3=require("d3");module.exports=Rickshaw}/*
Copyright (c) 2005-2010 Sam Stephenson

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
!function(t){function n(t){return h.call(t)===y}function e(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function r(t){if(i(t)!==v)throw new TypeError;var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n}function i(t){switch(t){case null:return f;case void 0:return d}var n=typeof t;switch(n){case"boolean":return p;case"number":return g;case"string":return m}return v}function a(t){return"undefined"==typeof t}function o(t){var n=t.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=n.length||n[0]?n:[]}function s(t,n){var e=t;return function(){var t=u([l(e,this)],arguments);return n.apply(this,t)}}function u(t,n){for(var e=t.length,r=n.length;r--;)t[e+r]=n[r];return t}function c(t,n){return t=x.call(t,0),u(t,n)}function l(t,n){if(arguments.length<2&&a(arguments[0]))return this;var e=t,r=x.call(arguments,2);return function(){var t=c(r,arguments);return e.apply(n,t)}}var h=Object.prototype.toString,f="Null",d="Undefined",p="Boolean",g="Number",m="String",v="Object",y="[object Function]",x=Array.prototype.slice,b=function(){},w=function(){function t(){}function i(){function r(){this.initialize.apply(this,arguments)}var i=null,a=[].slice.apply(arguments);if(n(a[0])&&(i=a.shift()),e(r,w.Methods),r.superclass=i,r.subclasses=[],i){t.prototype=i.prototype,r.prototype=new t;try{i.subclasses.push(r)}catch(o){}}for(var s=0,u=a.length;u>s;s++)r.addMethods(a[s]);return r.prototype.initialize||(r.prototype.initialize=b),r.prototype.constructor=r,r}function a(t){var e=this.superclass&&this.superclass.prototype,i=r(t);u&&(t.toString!=Object.prototype.toString&&i.push("toString"),t.valueOf!=Object.prototype.valueOf&&i.push("valueOf"));for(var a=0,c=i.length;c>a;a++){var h=i[a],f=t[h];if(e&&n(f)&&"$super"==o(f)[0]){var d=f;f=s(function(t){return function(){return e[t].apply(this,arguments)}}(h),d),f.valueOf=l(d.valueOf,d),f.toString=l(d.toString,d)}this.prototype[h]=f}return this}var u=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}();return{create:i,Methods:{addMethods:a}}}();t.exports?t.exports.Class=w:t.Class=w}(Rickshaw),Rickshaw.namespace("Rickshaw.Compat.ClassList"),Rickshaw.Compat.ClassList=function(){"undefined"==typeof document||"classList"in document.createElement("a")||function(t){"use strict";var n="classList",e="prototype",r=(t.HTMLElement||t.Element)[e],i=Object,a=String[e].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[e].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},s=function(t,n){this.name=t,this.code=DOMException[t],this.message=n},u=function(t,n){if(""===n)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(n))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(t,n)},c=function(t){for(var n=a.call(t.className),e=n?n.split(/\s+/):[],r=0,i=e.length;i>r;r++)this.push(e[r]);this._updateClassName=function(){t.className=this.toString()}},l=c[e]=[],h=function(){return new c(this)};if(s[e]=Error[e],l.item=function(t){return this[t]||null},l.contains=function(t){return t+="",-1!==u(this,t)},l.add=function(t){t+="",-1===u(this,t)&&(this.push(t),this._updateClassName())},l.remove=function(t){t+="";var n=u(this,t);-1!==n&&(this.splice(n,1),this._updateClassName())},l.toggle=function(t){t+="",-1===u(this,t)?this.add(t):this.remove(t)},l.toString=function(){return this.join(" ")},i.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{i.defineProperty(r,n,f)}catch(d){-2146823252===d.number&&(f.enumerable=!1,i.defineProperty(r,n,f))}}else i[e].__defineGetter__&&r.__defineGetter__(n,h)}(window)},("undefined"!=typeof RICKSHAW_NO_COMPAT&&!RICKSHAW_NO_COMPAT||"undefined"==typeof RICKSHAW_NO_COMPAT)&&new Rickshaw.Compat.ClassList,Rickshaw.namespace("Rickshaw.Graph"),Rickshaw.Graph=function(t){if(!t.element)throw"Rickshaw.Graph needs a reference to an element";this.element=t.element,this.series=t.series,this.defaults={interpolation:"cardinal",offset:"zero",min:void 0,max:void 0,preserve:!1},Rickshaw.keys(this.defaults).forEach(function(n){this[n]=t[n]||this.defaults[n]},this),this.window={},this.updateCallbacks=[];var n=this;this.initialize=function(t){this.validateSeries(t.series),this.series.active=function(){return n.series.filter(function(t){return!t.disabled})},this.setSize({width:t.width,height:t.height}),this.element.classList.add("rickshaw_graph"),this.vis=d3.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height);for(var e in Rickshaw.Graph.Renderer)if(e&&Rickshaw.Graph.Renderer.hasOwnProperty(e)){var r=Rickshaw.Graph.Renderer[e];r&&r.prototype&&r.prototype.render&&n.registerRenderer(new r({graph:n}))}this.setRenderer(t.renderer||"stack",t),this.discoverRange()},this.validateSeries=function(t){if(!(Array.isArray(t)||t instanceof Rickshaw.Series)){var n=Object.prototype.toString.apply(t);throw"series is not an array: "+n}t.forEach(function(t){if(!(t instanceof Object))throw"series element is not an object: "+t;if(!t.data)throw"series has no data: "+JSON.stringify(t);if(!Array.isArray(t.data))throw"series data is not an array: "+JSON.stringify(t.data);var n=t.data[0].x,e=t.data[0].y;if("number"!=typeof n||"number"!=typeof e&&null!==e)throw"x and y properties of points should be numbers instead of "+typeof n+" and "+typeof e;if(t.data.length>=3&&(t.data[2].x<t.data[1].x||t.data[1].x<t.data[0].x||t.data[t.data.length-1].x<t.data[0].x))throw"series data needs to be sorted on x values for series name: "+t.name},this)},this.dataDomain=function(){var t=this.series.map(function(t){return t.data}),n=d3.min(t.map(function(t){return t[0].x})),e=d3.max(t.map(function(t){return t[t.length-1].x}));return[n,e]},this.discoverRange=function(){var t=this.renderer.domain();this.x=d3.scale.linear().domain(t.x).range([0,this.width]),this.y=d3.scale.linear().domain(t.y).range([this.height,0]),this.y.magnitude=d3.scale.linear().domain([t.y[0]-t.y[0],t.y[1]-t.y[0]]).range([0,this.height])},this.render=function(){this.stackData(),this.discoverRange(),this.renderer.render(),this.updateCallbacks.forEach(function(t){t()})},this.update=this.render,this.stackData=function(){var t=this.series.active().map(function(t){return t.data}).map(function(t){return t.filter(function(t){return this._slice(t)},this)},this),e=this.preserve;e||this.series.forEach(function(t){t.scale&&(e=!0)}),t=e?Rickshaw.clone(t):t,this.series.active().forEach(function(n,e){if(n.scale){var r=t[e];r&&r.forEach(function(t){t.y=n.scale(t.y)})}}),this.stackData.hooks.data.forEach(function(e){t=e.f.apply(n,[t])});var r;if(!this.renderer.unstack){this._validateStackable();var i=d3.layout.stack();i.offset(n.offset),r=i(t)}r=r||t,this.stackData.hooks.after.forEach(function(e){r=e.f.apply(n,[t])});var a=0;return this.series.forEach(function(t){t.disabled||(t.stack=r[a++])}),this.stackedData=r,r},this._validateStackable=function(){var t,n=this.series;n.forEach(function(n){if(t=t||n.data.length,t&&n.data.length!=t)throw"stacked series cannot have differing numbers of points: "+t+" vs "+n.data.length+"; see Rickshaw.Series.fill()"},this)},this.stackData.hooks={data:[],after:[]},this._slice=function(t){if(this.window.xMin||this.window.xMax){var n=!0;return this.window.xMin&&t.x<this.window.xMin&&(n=!1),this.window.xMax&&t.x>this.window.xMax&&(n=!1),n}return!0},this.onUpdate=function(t){this.updateCallbacks.push(t)},this.registerRenderer=function(t){this._renderers=this._renderers||{},this._renderers[t.name]=t},this.configure=function(t){(t.width||t.height)&&this.setSize(t),Rickshaw.keys(this.defaults).forEach(function(n){this[n]=n in t?t[n]:n in this?this[n]:this.defaults[n]},this),this.setRenderer(t.renderer||this.renderer.name,t)},this.setRenderer=function(t,e){if("function"==typeof t)this.renderer=new t({graph:n}),this.registerRenderer(this.renderer);else{if(!this._renderers[t])throw"couldn't find renderer "+t;this.renderer=this._renderers[t]}"object"==typeof e&&this.renderer.configure(e)},this.setSize=function(t){if(t=t||{},void 0!==typeof window)var n=window.getComputedStyle(this.element,null),e=parseInt(n.getPropertyValue("width"),10),r=parseInt(n.getPropertyValue("height"),10);this.width=t.width||e||400,this.height=t.height||r||250,this.vis&&this.vis.attr("width",this.width).attr("height",this.height)},this.initialize(t)},Rickshaw.namespace("Rickshaw.Fixtures.Color"),Rickshaw.Fixtures.Color=function(){this.schemes={},this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse(),this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"],this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"],this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse(),this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"},this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse(),this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"],this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]},Rickshaw.namespace("Rickshaw.Fixtures.RandomData"),Rickshaw.Fixtures.RandomData=function(t){t=t||1;var n=200,e=Math.floor((new Date).getTime()/1e3);this.addData=function(r){var i=100*Math.random()+15+n,a=r[0].length,o=1;r.forEach(function(n){var r=20*Math.random(),s=i/25+o++ +15*(Math.cos(11*a*o/960)+2)+7*(Math.cos(a/7)+2)+1*(Math.cos(a/17)+2);n.push({x:a*t+e,y:s+r})}),n=.85*i},this.removeData=function(n){n.forEach(function(t){t.shift()}),e+=t}},Rickshaw.namespace("Rickshaw.Fixtures.Time"),Rickshaw.Fixtures.Time=function(){60*(new Date).getTimezoneOffset();var t=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(t){return 10*parseInt(t.getUTCFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(t){return t.getUTCFullYear()}},{name:"month",seconds:2635200,formatter:function(n){return t.months[n.getUTCMonth()]}},{name:"week",seconds:604800,formatter:function(n){return t.formatDate(n)}},{name:"day",seconds:86400,formatter:function(t){return t.getUTCDate()}},{name:"6 hour",seconds:21600,formatter:function(n){return t.formatTime(n)}},{name:"hour",seconds:3600,formatter:function(n){return t.formatTime(n)}},{name:"15 minute",seconds:900,formatter:function(n){return t.formatTime(n)}},{name:"minute",seconds:60,formatter:function(t){return t.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(t){return t.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(t){return t.getUTCSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(t){return t.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(t){return t.getUTCMilliseconds()+"ms"}}],this.unit=function(t){return this.units.filter(function(n){return t==n.name}).shift()},this.formatDate=function(t){return d3.time.format("%b %e")(t)},this.formatTime=function(t){return t.toUTCString().match(/(\d+:\d+):/)[1]},this.ceil=function(t,n){var e,r;return"month"==n.name?(e=new Date(1e3*(t+n.seconds-1)),r=new Date(0),r.setUTCFullYear(e.getUTCFullYear()),r.setUTCMonth(e.getUTCMonth()),r.setUTCDate(1),r.setUTCHours(0),r.setUTCMinutes(0),r.setUTCSeconds(0),r.setUTCMilliseconds(0),r.getTime()/1e3):"year"==n.name?(e=new Date(1e3*(t+n.seconds-1)),r=new Date(0),r.setUTCFullYear(e.getUTCFullYear()),r.setUTCMonth(0),r.setUTCDate(1),r.setUTCHours(0),r.setUTCMinutes(0),r.setUTCSeconds(0),r.setUTCMilliseconds(0),r.getTime()/1e3):Math.ceil(t/n.seconds)*n.seconds}},Rickshaw.namespace("Rickshaw.Fixtures.Time.Local"),Rickshaw.Fixtures.Time.Local=function(){60*(new Date).getTimezoneOffset();var t=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(t){return 10*parseInt(t.getFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(t){return t.getFullYear()}},{name:"month",seconds:2635200,formatter:function(n){return t.months[n.getMonth()]}},{name:"week",seconds:604800,formatter:function(n){return t.formatDate(n)}},{name:"day",seconds:86400,formatter:function(t){return t.getDate()}},{name:"6 hour",seconds:21600,formatter:function(n){return t.formatTime(n)}},{name:"hour",seconds:3600,formatter:function(n){return t.formatTime(n)}},{name:"15 minute",seconds:900,formatter:function(n){return t.formatTime(n)}},{name:"minute",seconds:60,formatter:function(t){return t.getMinutes()}},{name:"15 second",seconds:15,formatter:function(t){return t.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(t){return t.getSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(t){return t.getMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(t){return t.getMilliseconds()+"ms"}}],this.unit=function(t){return this.units.filter(function(n){return t==n.name}).shift()},this.formatDate=function(t){return d3.time.format("%b %e")(t)},this.formatTime=function(t){return t.toString().match(/(\d+:\d+):/)[1]},this.ceil=function(t,n){var e,r;return"day"==n.name?(e=new Date(1e3*(t+n.seconds-1)),r=new Date(0),r.setMilliseconds(0),r.setSeconds(0),r.setMinutes(0),r.setHours(0),r.setDate(e.getDate()),r.setMonth(e.getMonth()),r.setFullYear(e.getFullYear()),r.getTime()/1e3):"month"==n.name?(e=new Date(1e3*(t+n.seconds-1)),r=new Date(0),r.setMilliseconds(0),r.setSeconds(0),r.setMinutes(0),r.setHours(0),r.setDate(1),r.setMonth(e.getMonth()),r.setFullYear(e.getFullYear()),r.getTime()/1e3):"year"==n.name?(e=new Date(1e3*(t+n.seconds-1)),r=new Date(0),r.setFullYear(e.getFullYear()),r.setMilliseconds(0),r.setSeconds(0),r.setMinutes(0),r.setHours(0),r.setDate(1),r.setMonth(0),r.getTime()/1e3):Math.ceil(t/n.seconds)*n.seconds}},Rickshaw.namespace("Rickshaw.Fixtures.Number"),Rickshaw.Fixtures.Number.formatKMBT=function(t){var n=Math.abs(t);return n>=1e12?t/1e12+"T":n>=1e9?t/1e9+"B":n>=1e6?t/1e6+"M":n>=1e3?t/1e3+"K":1>n&&t>0?t.toFixed(2):0===n?"":t},Rickshaw.Fixtures.Number.formatBase1024KMGTP=function(t){var n=Math.abs(t);return n>=0x4000000000000?t/0x4000000000000+"P":n>=1099511627776?t/1099511627776+"T":n>=1073741824?t/1073741824+"G":n>=1048576?t/1048576+"M":n>=1024?t/1024+"K":1>n&&t>0?t.toFixed(2):0===n?"":t},Rickshaw.namespace("Rickshaw.Color.Palette"),Rickshaw.Color.Palette=function(t){var n=new Rickshaw.Fixtures.Color;if(t=t||{},this.schemes={},this.scheme=n.schemes[t.scheme]||t.scheme||n.schemes.colorwheel,this.runningIndex=0,this.generatorIndex=0,t.interpolatedStopCount){var e,r,i=this.scheme.length-1,a=[];for(e=0;i>e;e++){a.push(this.scheme[e]);var o=d3.interpolateHsl(this.scheme[e],this.scheme[e+1]);for(r=1;r<t.interpolatedStopCount;r++)a.push(o(1/t.interpolatedStopCount*r))}a.push(this.scheme[this.scheme.length-1]),this.scheme=a}this.rotateCount=this.scheme.length,this.color=function(t){return this.scheme[t]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"},this.interpolateColor=function(){if(Array.isArray(this.scheme)){var t;return this.generatorIndex==2*this.rotateCount-1?(t=d3.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(.5),this.generatorIndex=0,this.rotateCount*=2):(t=d3.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(.5),this.generatorIndex++),this.scheme.push(t),t}}},Rickshaw.namespace("Rickshaw.Graph.Ajax"),Rickshaw.Graph.Ajax=Rickshaw.Class.create({initialize:function(t){this.dataURL=t.dataURL,this.onData=t.onData||function(t){return t},this.onComplete=t.onComplete||function(){},this.onError=t.onError||function(){},this.args=t,this.request()},request:function(){$.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL),this.onError(this)},success:function(t){t=this.onData(t),this.args.series=this._splice({data:t,series:this.args.series}),this.graph=this.graph||new Rickshaw.Graph(this.args),this.graph.render(),this.onComplete(this)},_splice:function(t){var n=t.data,e=t.series;return t.series?(e.forEach(function(t){var e=t.key||t.name;if(!e)throw"series needs a key or a name";n.forEach(function(n){var r=n.key||n.name;if(!r)throw"data needs a key or a name";if(e==r){var i=["color","name","data"];i.forEach(function(e){n[e]&&(t[e]=n[e])})}})}),e):n}}),Rickshaw.namespace("Rickshaw.Graph.Annotate"),Rickshaw.Graph.Annotate=function(t){this.graph=t.graph,this.elements={timeline:t.element};var n=this;this.data={},this.elements.timeline.classList.add("rickshaw_annotation_timeline"),this.add=function(t,e,r){n.data[t]=n.data[t]||{boxes:[]},n.data[t].boxes.push({content:e,end:r})},this.update=function(){Rickshaw.keys(n.data).forEach(function(t){var e=n.data[t],r=n.graph.x(t);if(0>r||r>n.graph.x.range()[1])return e.element&&(e.line.classList.add("offscreen"),e.element.style.display="none"),e.boxes.forEach(function(t){t.rangeElement&&t.rangeElement.classList.add("offscreen")}),void 0;if(!e.element){var i=e.element=document.createElement("div");i.classList.add("annotation"),this.elements.timeline.appendChild(i),i.addEventListener("click",function(){i.classList.toggle("active"),e.line.classList.toggle("active"),e.boxes.forEach(function(t){t.rangeElement&&t.rangeElement.classList.toggle("active")})},!1)}e.element.style.left=r+"px",e.element.style.display="block",e.boxes.forEach(function(t){var i=t.element;if(i||(i=t.element=document.createElement("div"),i.classList.add("content"),i.innerHTML=t.content,e.element.appendChild(i),e.line=document.createElement("div"),e.line.classList.add("annotation_line"),n.graph.element.appendChild(e.line),t.end&&(t.rangeElement=document.createElement("div"),t.rangeElement.classList.add("annotation_range"),n.graph.element.appendChild(t.rangeElement))),t.end){var a=r,o=Math.min(n.graph.x(t.end),n.graph.x.range()[1]);a>o&&(o=r,a=Math.max(n.graph.x(t.end),n.graph.x.range()[0]));var s=o-a;t.rangeElement.style.left=a+"px",t.rangeElement.style.width=s+"px",t.rangeElement.classList.remove("offscreen")}e.line.classList.remove("offscreen"),e.line.style.left=r+"px"})},this)},this.graph.onUpdate(function(){n.update()})},Rickshaw.namespace("Rickshaw.Graph.Axis.Time"),Rickshaw.Graph.Axis.Time=function(t){var n=this;this.graph=t.graph,this.elements=[],this.ticksTreatment=t.ticksTreatment||"plain",this.fixedTimeUnit=t.timeUnit;var e=t.timeFixture||new Rickshaw.Fixtures.Time;this.appropriateTimeUnit=function(){var t,n=e.units,r=this.graph.x.domain(),i=r[1]-r[0];return n.forEach(function(n){Math.floor(i/n.seconds)>=2&&(t=t||n)}),t||e.units[e.units.length-1]},this.tickOffsets=function(){for(var t=this.graph.x.domain(),n=this.fixedTimeUnit||this.appropriateTimeUnit(),r=Math.ceil((t[1]-t[0])/n.seconds),i=t[0],a=[],o=0;r>o;o++){var s=e.ceil(i,n);i=s+n.seconds/2,a.push({value:s,unit:n})}return a},this.render=function(){this.elements.forEach(function(t){t.parentNode.removeChild(t)}),this.elements=[];var t=this.tickOffsets();t.forEach(function(t){if(!(n.graph.x(t.value)>n.graph.x.range()[1])){var e=document.createElement("div");e.style.left=n.graph.x(t.value)+"px",e.classList.add("x_tick"),e.classList.add(n.ticksTreatment);var r=document.createElement("div");r.classList.add("title"),r.innerHTML=t.unit.formatter(new Date(1e3*t.value)),e.appendChild(r),n.graph.element.appendChild(e),n.elements.push(e)}})},this.graph.onUpdate(function(){n.render()})},Rickshaw.namespace("Rickshaw.Graph.Axis.X"),Rickshaw.Graph.Axis.X=function(t){var n=this,e=.1;this.initialize=function(t){this.graph=t.graph,this.orientation=t.orientation||"top",this.pixelsPerTick=t.pixelsPerTick||75,t.ticks&&(this.staticTicks=t.ticks),t.tickValues&&(this.tickValues=t.tickValues),this.tickSize=t.tickSize||4,this.ticksTreatment=t.ticksTreatment||"plain",t.element?(this.element=t.element,this._discoverSize(t.element,t),this.vis=d3.select(t.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:t.width,height:t.height})):this.vis=this.graph.vis,this.graph.onUpdate(function(){n.render()})},this.setSize=function(t){if(t=t||{},this.element){this._discoverSize(this.element.parentNode,t),this.vis.attr("height",this.height).attr("width",this.width*(1+e));var n=Math.floor(this.width*e/2);this.element.style.left=-1*n+"px"}},this.render=function(){void 0!==this._renderWidth&&this.graph.width!==this._renderWidth&&this.setSize({auto:!0});var n=d3.svg.axis().scale(this.graph.x).orient(this.orientation);n.tickFormat(t.tickFormat||function(t){return t}),this.tickValues&&n.tickValues(this.tickValues),this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var r,i=Math.floor(this.width*e/2)||0;if("top"==this.orientation){var a=this.height||this.graph.height;r="translate("+i+","+a+")"}else r="translate("+i+", 0)";this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",r).call(n.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var o=("bottom"==this.orientation?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(n.ticks(this.ticks).tickSubdivide(0).tickSize(o)),this._renderHeight=this.graph.height},this._discoverSize=function(t,n){if("undefined"!=typeof window){var r=window.getComputedStyle(t,null),i=parseInt(r.getPropertyValue("height"),10);if(!n.auto)var a=parseInt(r.getPropertyValue("width"),10)}this.width=(n.width||a||this.graph.width)*(1+e),this.height=n.height||i||40},this.initialize(t)},Rickshaw.namespace("Rickshaw.Graph.Axis.Y"),Rickshaw.Graph.Axis.Y=Rickshaw.Class.create({initialize:function(t){this.graph=t.graph,this.orientation=t.orientation||"right",this.pixelsPerTick=t.pixelsPerTick||75,t.ticks&&(this.staticTicks=t.ticks),t.tickValues&&(this.tickValues=t.tickValues),this.tickSize=t.tickSize||4,this.ticksTreatment=t.ticksTreatment||"plain",this.tickFormat=t.tickFormat||function(t){return t},this.berthRate=.1,t.element?(this.element=t.element,this.vis=d3.select(t.element).append("svg:svg").attr("class","rickshaw_graph y_axis"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:t.width,height:t.height})):this.vis=this.graph.vis;var n=this;this.graph.onUpdate(function(){n.render()})},setSize:function(t){if(t=t||{},this.element){if("undefined"!=typeof window){var n=window.getComputedStyle(this.element.parentNode,null),e=parseInt(n.getPropertyValue("width"),10);if(!t.auto)var r=parseInt(n.getPropertyValue("height"),10)}this.width=t.width||e||this.graph.width*this.berthRate,this.height=t.height||r||this.graph.height,this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var i=this.height*this.berthRate;"left"==this.orientation&&(this.element.style.top=-1*i+"px")}},render:function(){void 0!==this._renderHeight&&this.graph.height!==this._renderHeight&&this.setSize({auto:!0}),this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var t=this._drawAxis(this.graph.y);this._drawGrid(t),this._renderHeight=this.graph.height},_drawAxis:function(t){var n=d3.svg.axis().scale(t).orient(this.orientation);if(n.tickFormat(this.tickFormat),this.tickValues&&n.tickValues(this.tickValues),"left"==this.orientation)var e=this.height*this.berthRate,r="translate("+this.width+", "+e+")";return this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",r).call(n.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize)),n},_drawGrid:function(t){var n=("right"==this.orientation?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(t.ticks(this.ticks).tickSubdivide(0).tickSize(n))}}),Rickshaw.namespace("Rickshaw.Graph.Axis.Y.Scaled"),Rickshaw.Graph.Axis.Y.Scaled=Rickshaw.Class.create(Rickshaw.Graph.Axis.Y,{initialize:function($super,t){if("undefined"==typeof t.scale)throw new Error("Scaled requires scale");this.scale=t.scale,this.grid="undefined"==typeof t.grid?!0:t.grid,$super(t)},_drawAxis:function($super,t){var n=this.scale.domain(),e=this.graph.renderer.domain().y,r=[Math.min.apply(Math,n),Math.max.apply(Math,n)],i=d3.scale.linear().domain([0,1]).range(r),a=[i(e[0]),i(e[1])],o=d3.scale.linear().domain(r).range(a),s=this.scale.copy().domain(n.map(o)).range(t.range());return $super(s)},_drawGrid:function($super,t){this.grid&&$super(t)}}),Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Highlight"),Rickshaw.Graph.Behavior.Series.Highlight=function(t){this.graph=t.graph,this.legend=t.legend;var n=this,e={},r=null,i=t.disabledColor||function(t){return d3.interpolateRgb(t,d3.rgb("#d8d8d8"))(.8).toString()};this.addHighlightEvents=function(t){t.element.addEventListener("mouseover",function(){r||(r=t,n.legend.lines.forEach(function(r){if(t!==r)e[r.series.name]=e[r.series.name]||r.series.color,r.series.color=i(r.series.color);else if(n.graph.renderer.unstack&&(r.series.renderer?r.series.renderer.unstack:!0)){var a=n.graph.series.indexOf(r.series);r.originalIndex=a;var o=n.graph.series.splice(a,1)[0];n.graph.series.push(o)}}),n.graph.update())},!1),t.element.addEventListener("mouseout",function(){r&&(r=null,n.legend.lines.forEach(function(r){if(t===r&&r.hasOwnProperty("originalIndex")){var i=n.graph.series.pop();n.graph.series.splice(r.originalIndex,0,i),delete r.originalIndex}e[r.series.name]&&(r.series.color=e[r.series.name])}),n.graph.update())},!1)},this.legend&&this.legend.lines.forEach(function(t){n.addHighlightEvents(t)})},Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Order"),Rickshaw.Graph.Behavior.Series.Order=function(t){this.graph=t.graph,this.legend=t.legend;var n=this;if("undefined"==typeof window.$)throw"couldn't find jQuery at window.$";if("undefined"==typeof window.$.ui)throw"couldn't find jQuery UI at window.$.ui";$(function(){$(n.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(){var t=[];$(n.legend.list).find("li").each(function(n,e){e.series&&t.push(e.series)});for(var e=n.graph.series.length-1;e>=0;e--)n.graph.series[e]=t.shift();n.graph.update()}}),$(n.legend.list).disableSelection()}),this.graph.onUpdate(function(){var t=window.getComputedStyle(n.legend.element).height;n.legend.element.style.height=t})},Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Toggle"),Rickshaw.Graph.Behavior.Series.Toggle=function(t){this.graph=t.graph,this.legend=t.legend;var n=this;this.addAnchor=function(t){var e=document.createElement("a");e.innerHTML="&#10004;",e.classList.add("action"),t.element.insertBefore(e,t.element.firstChild),e.onclick=function(){if(t.series.disabled)t.series.enable(),t.element.classList.remove("disabled");else{if(this.graph.series.filter(function(t){return!t.disabled}).length<=1)return;t.series.disable(),t.element.classList.add("disabled")}}.bind(this);var r=t.element.getElementsByTagName("span")[0];r.onclick=function(){var e=t.series.disabled;if(!e)for(var r=0;r<n.legend.lines.length;r++){var i=n.legend.lines[r];if(t.series===i.series);else if(!i.series.disabled){e=!0;break}}e?(t.series.enable(),t.element.classList.remove("disabled"),n.legend.lines.forEach(function(n){t.series===n.series||(n.series.disable(),n.element.classList.add("disabled"))})):n.legend.lines.forEach(function(t){t.series.enable(),t.element.classList.remove("disabled")})}},this.legend&&("undefined"!=typeof $&&$(this.legend.list).sortable&&$(this.legend.list).sortable({start:function(t,n){n.item.bind("no.onclick",function(t){t.preventDefault()})},stop:function(t,n){setTimeout(function(){n.item.unbind("no.onclick")},250)}}),this.legend.lines.forEach(function(t){n.addAnchor(t)})),this._addBehavior=function(){this.graph.series.forEach(function(t){t.disable=function(){if(n.graph.series.length<=1)throw"only one series left";t.disabled=!0,n.graph.update()},t.enable=function(){t.disabled=!1,n.graph.update()}})},this._addBehavior(),this.updateBehaviour=function(){this._addBehavior()}},Rickshaw.namespace("Rickshaw.Graph.HoverDetail"),Rickshaw.Graph.HoverDetail=Rickshaw.Class.create({initialize:function(t){var n=this.graph=t.graph;this.xFormatter=t.xFormatter||function(t){return new Date(1e3*t).toUTCString()},this.yFormatter=t.yFormatter||function(t){return null===t?t:t.toFixed(2)};var e=this.element=document.createElement("div");e.className="detail",this.visible=!0,n.element.appendChild(e),this.lastEvent=null,this._addListeners(),this.onShow=t.onShow,this.onHide=t.onHide,this.onRender=t.onRender,this.formatter=t.formatter||this.formatter},formatter:function(t,n,e,r,i){return t.name+":&nbsp;"+i},update:function(t){if(t=t||this.lastEvent,t&&(this.lastEvent=t,t.target.nodeName.match(/^(path|svg|rect|circle)$/))){var n,e=this.graph,r=t.offsetX||t.layerX,i=t.offsetY||t.layerY,a=0,o=[];if(this.graph.series.active().forEach(function(t){var s=this.graph.stackedData[a++];if(s.length){var u=e.x.invert(r),c=d3.scale.linear().domain([s[0].x,s.slice(-1)[0].x]).range([0,s.length-1]),l=Math.round(c(u));l==s.length-1&&l--;for(var h=Math.min(l||0,s.length-1),f=l;f<s.length-1&&s[f]&&s[f+1];){if(s[f].x<=u&&s[f+1].x>u){h=Math.abs(u-s[f].x)<Math.abs(u-s[f+1].x)?f:f+1;break}s[f+1].x<=u?f++:f--}0>h&&(h=0);var d=s[h],p=Math.sqrt(Math.pow(Math.abs(e.x(d.x)-r),2)+Math.pow(Math.abs(e.y(d.y+d.y0)-i),2)),g=t.xFormatter||this.xFormatter,m=t.yFormatter||this.yFormatter,v={formattedXValue:g(d.x),formattedYValue:m(t.scale?t.scale.invert(d.y):d.y),series:t,value:d,distance:p,order:a,name:t.name};(!n||p<n.distance)&&(n=v),o.push(v)}},this),n){n.active=!0;var s=n.value.x,u=n.formattedXValue;this.element.innerHTML="",this.element.style.left=e.x(s)+"px",this.visible&&this.render({points:o,detail:o,mouseX:r,mouseY:i,formattedXValue:u,domainX:s})}}},hide:function(){this.visible=!1,this.element.classList.add("inactive"),"function"==typeof this.onHide&&this.onHide()},show:function(){this.visible=!0,this.element.classList.remove("inactive"),"function"==typeof this.onShow&&this.onShow()},render:function(t){var n=this.graph,e=t.points,r=e.filter(function(t){return t.active}).shift();if(null!==r.value.y){var i=r.formattedXValue,a=r.formattedYValue;this.element.innerHTML="",this.element.style.left=n.x(r.value.x)+"px";var o=document.createElement("div");o.className="x_label",o.innerHTML=i,this.element.appendChild(o);var s=document.createElement("div");s.className="item";var u=r.series,c=u.scale?u.scale.invert(r.value.y):r.value.y;s.innerHTML=this.formatter(u,r.value.x,c,i,a,r),s.style.top=this.graph.y(r.value.y0+r.value.y)+"px",this.element.appendChild(s);var l=document.createElement("div");l.className="dot",l.style.top=s.style.top,l.style.borderColor=u.color,this.element.appendChild(l),r.active&&(s.classList.add("active"),l.classList.add("active"));var h=[o,s];h.forEach(function(t){t.classList.add("left")}),this.show();var f=this._calcLayoutError(h);if(f>0){h.forEach(function(t){t.classList.remove("left"),t.classList.add("right")});var d=this._calcLayoutError(h);d>f&&h.forEach(function(t){t.classList.remove("right"),t.classList.add("left")})}"function"==typeof this.onRender&&this.onRender(t)}},_calcLayoutError:function(t){var n=this.element.parentNode.getBoundingClientRect(),e=0;return t.forEach(function(t){var r=t.getBoundingClientRect();r.width&&(r.right>n.right&&(e+=r.right-n.right),r.left<n.left&&(e+=n.left-r.left))}),e},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(t){this.visible=!0,this.update(t)}.bind(this),!1),this.graph.onUpdate(function(){this.update()}.bind(this)),this.graph.element.addEventListener("mouseout",function(t){!t.relatedTarget||t.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS||this.hide()
}.bind(this),!1)}}),Rickshaw.namespace("Rickshaw.Graph.JSONP"),Rickshaw.Graph.JSONP=Rickshaw.Class.create(Rickshaw.Graph.Ajax,{request:function(){$.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}}),Rickshaw.namespace("Rickshaw.Graph.Legend"),Rickshaw.Graph.Legend=Rickshaw.Class.create({className:"rickshaw_legend",initialize:function(t){this.element=t.element,this.graph=t.graph,this.naturalOrder=t.naturalOrder,this.element.classList.add(this.className),this.list=document.createElement("ul"),this.element.appendChild(this.list),this.render(),this.graph.onUpdate(function(){})},render:function(){for(var t=this;this.list.firstChild;)this.list.removeChild(this.list.firstChild);this.lines=[];var n=this.graph.series.map(function(t){return t});this.naturalOrder||(n=n.reverse()),n.forEach(function(n){t.addLine(n)})},addLine:function(t){var n=document.createElement("li");n.className="line",t.disabled&&(n.className+=" disabled");var e=document.createElement("div");e.className="swatch",e.style.backgroundColor=t.color,n.appendChild(e);var r=document.createElement("span");r.className="label",r.innerHTML=t.name,n.appendChild(r),this.list.appendChild(n),n.series=t,t.noLegend&&(n.style.display="none");var i={element:n,series:t};return this.shelving&&(this.shelving.addAnchor(i),this.shelving.updateBehaviour()),this.highlighter&&this.highlighter.addHighlightEvents(i),this.lines.push(i),n}}),Rickshaw.namespace("Rickshaw.Graph.RangeSlider"),Rickshaw.Graph.RangeSlider=Rickshaw.Class.create({initialize:function(t){this.element=t.element;var n=this.graph=t.graph;this.build(),n.onUpdate(function(){this.update()}.bind(this))},build:function(){var t=this.element,n=this.graph,e=n.dataDomain();$(function(){$(t).slider({range:!0,min:e[0],max:e[1],values:[e[0],e[1]],slide:function(t,e){if(!(e.values[1]<=e.values[0])){n.window.xMin=e.values[0],n.window.xMax=e.values[1],n.update();var r=n.dataDomain();r[0]==e.values[0]&&(n.window.xMin=void 0),r[1]==e.values[1]&&(n.window.xMax=void 0)}}})}),$(t)[0].style.width=n.width+"px"},update:function(){var t=this.element,n=this.graph,e=$(t).slider("option","values"),r=n.dataDomain();$(t).slider("option","min",r[0]),$(t).slider("option","max",r[1]),null==n.window.xMin&&(e[0]=r[0]),null==n.window.xMax&&(e[1]=r[1]),$(t).slider("option","values",e)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer"),Rickshaw.Graph.Renderer=Rickshaw.Class.create({initialize:function(t){this.graph=t.graph,this.tension=t.tension||this.tension,this.graph.unstacker=this.graph.unstacker||new Rickshaw.Graph.Unstacker({graph:this.graph}),this.configure(t)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:.8,strokeWidth:2,unstack:!0,padding:{top:.01,right:0,bottom:.01,left:0},stroke:!1,fill:!1}},domain:function(t){var n=t||this.graph.stackedData||this.graph.stackData(),e=n[0][0];if(void 0===e)return{x:[null,null],y:[null,null]};var r=e.x,i=e.x,a=e.y+e.y0,o=e.y+e.y0;return n.forEach(function(t){t.forEach(function(t){if(null!=t.y){var n=t.y+t.y0;a>n&&(a=n),n>o&&(o=n)}}),t.length&&(t[0].x<r&&(r=t[0].x),t[t.length-1].x>i&&(i=t[t.length-1].x))}),r-=(i-r)*this.padding.left,i+=(i-r)*this.padding.right,a="auto"===this.graph.min?a:this.graph.min||0,o=void 0===this.graph.max?o:this.graph.max,("auto"===this.graph.min||0>a)&&(a-=(o-a)*this.padding.bottom),void 0===this.graph.max&&(o+=(o-a)*this.padding.top),{x:[r,i],y:[a,o]}},render:function(t){t=t||{};var n=this.graph,e=t.series||n.series,r=t.vis||n.vis;r.selectAll("*").remove();var i=e.filter(function(t){return!t.disabled}).map(function(t){return t.stack}),a=r.selectAll("path").data(i).enter().append("svg:path").attr("d",this.seriesPathFactory()),o=0;e.forEach(function(t){t.disabled||(t.path=a[0][o++],this._styleSeries(t))},this)},_styleSeries:function(t){var n=this.fill?t.color:"none",e=this.stroke?t.color:"none";t.path.setAttribute("fill",n),t.path.setAttribute("stroke",e),t.path.setAttribute("stroke-width",this.strokeWidth),t.path.setAttribute("class",t.className)},configure:function(t){t=t||{},Rickshaw.keys(this.defaults()).forEach(function(n){return t.hasOwnProperty(n)?("object"==typeof this.defaults()[n]?Rickshaw.keys(this.defaults()[n]).forEach(function(e){this[n][e]=void 0!==t[n][e]?t[n][e]:void 0!==this[n][e]?this[n][e]:this.defaults()[n][e]},this):this[n]=void 0!==t[n]?t[n]:void 0!==this[n]?this[n]:void 0!==this.graph[n]?this.graph[n]:this.defaults()[n],void 0):(this[n]=this[n]||this.graph[n]||this.defaults()[n],void 0)},this)},setStrokeWidth:function(t){void 0!==t&&(this.strokeWidth=t)},setTension:function(t){void 0!==t&&(this.tension=t)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Line"),Rickshaw.Graph.Renderer.Line=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"line",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0})},seriesPathFactory:function(){var t=this.graph,n=d3.svg.line().x(function(n){return t.x(n.x)}).y(function(n){return t.y(n.y)}).interpolate(this.graph.interpolation).tension(this.tension);return n.defined&&n.defined(function(t){return null!==t.y}),n}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Stack"),Rickshaw.Graph.Renderer.Stack=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"stack",defaults:function($super){return Rickshaw.extend($super(),{fill:!0,stroke:!1,unstack:!1})},seriesPathFactory:function(){var t=this.graph,n=d3.svg.area().x(function(n){return t.x(n.x)}).y0(function(n){return t.y(n.y0)}).y1(function(n){return t.y(n.y+n.y0)}).interpolate(this.graph.interpolation).tension(this.tension);return n.defined&&n.defined(function(t){return null!==t.y}),n}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Bar"),Rickshaw.Graph.Renderer.Bar=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"bar",defaults:function($super){var t=Rickshaw.extend($super(),{gapSize:.05,unstack:!1});return delete t.tension,t},initialize:function($super,t){t=t||{},this.gapSize=t.gapSize||this.gapSize,$super(t)},domain:function($super){var t=$super(),n=this._frequentInterval(this.graph.stackedData.slice(-1).shift());return t.x[1]+=Number(n.magnitude),t},barWidth:function(t){var n=this._frequentInterval(t.stack),e=this.graph.x(t.stack[0].x+n.magnitude*(1-this.gapSize));return e},render:function(t){t=t||{};var n=this.graph,e=t.series||n.series,r=t.vis||n.vis;r.selectAll("*").remove();var i=this.barWidth(e.active()[0]),a=0,o=e.filter(function(t){return!t.disabled}).length,s=this.unstack?i/o:i,u=function(t){var e=[1,0,0,t.y<0?-1:1,0,t.y<0?2*n.y.magnitude(Math.abs(t.y)):0];return"matrix("+e.join(",")+")"};e.forEach(function(t){if(!t.disabled){this.barWidth(t);var e=r.selectAll("path").data(t.stack.filter(function(t){return null!==t.y})).enter().append("svg:rect").attr("x",function(t){return n.x(t.x)+a}).attr("y",function(t){return n.y(t.y0+Math.abs(t.y))*(t.y<0?-1:1)}).attr("width",s).attr("height",function(t){return n.y.magnitude(Math.abs(t.y))}).attr("transform",u);Array.prototype.forEach.call(e[0],function(n){n.setAttribute("fill",t.color)}),this.unstack&&(a+=s)}},this)},_frequentInterval:function(t){for(var n={},e=0;e<t.length-1;e++){var r=t[e+1].x-t[e].x;n[r]=n[r]||0,n[r]++}var i={count:0,magnitude:1};return Rickshaw.keys(n).forEach(function(t){i.count<n[t]&&(i={count:n[t],magnitude:t})}),i}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Area"),Rickshaw.Graph.Renderer.Area=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"area",defaults:function($super){return Rickshaw.extend($super(),{unstack:!1,fill:!1,stroke:!1})},seriesPathFactory:function(){var t=this.graph,n=d3.svg.area().x(function(n){return t.x(n.x)}).y0(function(n){return t.y(n.y0)}).y1(function(n){return t.y(n.y+n.y0)}).interpolate(t.interpolation).tension(this.tension);return n.defined&&n.defined(function(t){return null!==t.y}),n},seriesStrokeFactory:function(){var t=this.graph,n=d3.svg.line().x(function(n){return t.x(n.x)}).y(function(n){return t.y(n.y+n.y0)}).interpolate(t.interpolation).tension(this.tension);return n.defined&&n.defined(function(t){return null!==t.y}),n},render:function(t){t=t||{};var n=this.graph,e=t.series||n.series,r=t.vis||n.vis;r.selectAll("*").remove();var i=this.unstack?"append":"insert",a=e.filter(function(t){return!t.disabled}).map(function(t){return t.stack}),o=r.selectAll("path").data(a).enter()[i]("svg:g","g");o.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area"),this.stroke&&o.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line");var s=0;e.forEach(function(t){t.disabled||(t.path=o[0][s++],this._styleSeries(t))},this)},_styleSeries:function(t){t.path&&(d3.select(t.path).select(".area").attr("fill",t.color),this.stroke&&d3.select(t.path).select(".line").attr("fill","none").attr("stroke",t.stroke||d3.interpolateRgb(t.color,"black")(.125)).attr("stroke-width",this.strokeWidth),t.className&&t.path.setAttribute("class",t.className))}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.ScatterPlot"),Rickshaw.Graph.Renderer.ScatterPlot=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"scatterplot",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!0,stroke:!1,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:4})},initialize:function($super,t){$super(t)},render:function(t){t=t||{};var n=this.graph,e=t.series||n.series,r=t.vis||n.vis,i=this.dotSize;r.selectAll("*").remove(),e.forEach(function(t){if(!t.disabled){var e=r.selectAll("path").data(t.stack.filter(function(t){return null!==t.y})).enter().append("svg:circle").attr("cx",function(t){return n.x(t.x)}).attr("cy",function(t){return n.y(t.y)}).attr("r",function(t){return"r"in t?t.r:i});Array.prototype.forEach.call(e[0],function(n){n.setAttribute("fill",t.color)})}},this)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Multi"),Rickshaw.Graph.Renderer.Multi=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"multi",initialize:function($super,t){$super(t)},defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0})},configure:function($super,t){t=t||{},this.config=t,$super(t)},domain:function($super){this.graph.stackData();var t=[],n=this._groups();this._stack(n),n.forEach(function(n){var e=n.series.filter(function(t){return!t.disabled}).map(function(t){return t.stack});if(e.length){var r=$super(e);t.push(r)}});var e=d3.min(t.map(function(t){return t.x[0]})),r=d3.max(t.map(function(t){return t.x[1]})),i=d3.min(t.map(function(t){return t.y[0]})),a=d3.max(t.map(function(t){return t.y[1]}));return{x:[e,r],y:[i,a]}},_groups:function(){var t=this.graph,n={};t.series.forEach(function(e){if(!e.disabled){if(!n[e.renderer]){var r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"g");t.vis[0][0].appendChild(i);var a=t._renderers[e.renderer],o={},s=[this.defaults(),a.defaults(),this.config,this.graph];s.forEach(function(t){Rickshaw.extend(o,t)}),a.configure(o),n[e.renderer]={renderer:a,series:[],vis:d3.select(i)}}n[e.renderer].series.push(e)}},this);var e=[];return Object.keys(n).forEach(function(t){var r=n[t];e.push(r)}),e},_stack:function(t){return t.forEach(function(t){var n=t.series.filter(function(t){return!t.disabled}),e=n.map(function(t){return t.stack});if(!t.renderer.unstack){var r=d3.layout.stack(),i=Rickshaw.clone(r(e));n.forEach(function(t,n){t._stack=Rickshaw.clone(i[n])})}},this),t},render:function(){this.graph.series.forEach(function(t){if(!t.renderer)throw new Error("Each series needs a renderer for graph 'multi' renderer")}),this.graph.vis.selectAll("*").remove();var t=this._groups();t=this._stack(t),t.forEach(function(t){var n=t.series.filter(function(t){return!t.disabled});n.active=function(){return n},t.renderer.render({series:n,vis:t.vis}),n.forEach(function(t){t.stack=t._stack||t.stack||t.data})})}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.LinePlot"),Rickshaw.Graph.Renderer.LinePlot=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"lineplot",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:3,strokeWidth:2})},initialize:function($super,t){$super(t)},seriesPathFactory:function(){var t=this.graph,n=d3.svg.line().x(function(n){return t.x(n.x)}).y(function(n){return t.y(n.y)}).interpolate(this.graph.interpolation).tension(this.tension);return n.defined&&n.defined(function(t){return null!==t.y}),n},_renderDots:function(){var t=this.graph;t.series.forEach(function(n){if(!n.disabled){var e=t.vis.selectAll("x").data(n.stack.filter(function(t){return null!==t.y})).enter().append("svg:circle").attr("cx",function(n){return t.x(n.x)}).attr("cy",function(n){return t.y(n.y)}).attr("r",function(n){return"r"in n?n.r:t.renderer.dotSize});Array.prototype.forEach.call(e[0],function(t){t&&(t.setAttribute("data-color",n.color),t.setAttribute("fill","white"),t.setAttribute("stroke",n.color),t.setAttribute("stroke-width",this.strokeWidth))}.bind(this))}},this)},_renderLines:function(){var t=this.graph,n=t.vis.selectAll("path").data(this.graph.stackedData).enter().append("svg:path").attr("d",this.seriesPathFactory()),e=0;t.series.forEach(function(t){t.disabled||(t.path=n[0][e++],this._styleSeries(t))},this)},render:function(){var t=this.graph;t.vis.selectAll("*").remove(),this._renderLines(),this._renderDots()}}),Rickshaw.namespace("Rickshaw.Graph.Smoother"),Rickshaw.Graph.Smoother=Rickshaw.Class.create({initialize:function(t){this.graph=t.graph,this.element=t.element,this.aggregationScale=1,this.build(),this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var t=this;this.element&&$(function(){$(t.element).slider({min:1,max:100,slide:function(n,e){t.setScale(e.value),t.graph.update()}})})},setScale:function(t){if(1>t)throw"scale out of range: "+t;this.aggregationScale=t,this.graph.update()},transformer:function(t){if(1==this.aggregationScale)return t;var n=[];return t.forEach(function(t){for(var e=[];t.length;){var r=0,i=0,a=t.splice(0,this.aggregationScale);a.forEach(function(t){r+=t.x/a.length,i+=t.y/a.length}),e.push({x:r,y:i})}n.push(e)}.bind(this)),n}}),Rickshaw.namespace("Rickshaw.Graph.Socketio"),Rickshaw.Graph.Socketio=Rickshaw.Class.create(Rickshaw.Graph.Ajax,{request:function(){var t=io.connect(this.dataURL);thisData=this,t.on("rickshaw",function(t){thisData.success(t)})}}),Rickshaw.namespace("Rickshaw.Graph.Unstacker"),Rickshaw.Graph.Unstacker=function(t){this.graph=t.graph;var n=this;this.graph.stackData.hooks.after.push({name:"unstacker",f:function(t){return n.graph.renderer.unstack?(t.forEach(function(t){t.forEach(function(t){t.y0=0})}),t):t}})},Rickshaw.namespace("Rickshaw.Series"),Rickshaw.Series=Rickshaw.Class.create(Array,{initialize:function(t,n,e){e=e||{},this.palette=new Rickshaw.Color.Palette(n),this.timeBase="undefined"==typeof e.timeBase?Math.floor((new Date).getTime()/1e3):e.timeBase;var r="undefined"==typeof e.timeInterval?1e3:e.timeInterval;this.setTimeInterval(r),t&&"object"==typeof t&&Array.isArray(t)&&t.forEach(function(t){this.addItem(t)},this)},addItem:function(t){if("undefined"==typeof t.name)throw"addItem() needs a name";t.color=t.color||this.palette.color(t.name),t.data=t.data||[],0===t.data.length&&this.length&&this.getIndex()>0?this[0].data.forEach(function(n){t.data.push({x:n.x,y:0})}):0===t.data.length&&t.data.push({x:this.timeBase-(this.timeInterval||0),y:0}),this.push(t),this.legend&&this.legend.addLine(this.itemByName(t.name))},addData:function(t,n){var e=this.getIndex();Rickshaw.keys(t).forEach(function(t){this.itemByName(t)||this.addItem({name:t})},this),this.forEach(function(r){r.data.push({x:n||(e*this.timeInterval||1)+this.timeBase,y:t[r.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(t){for(var n=0;n<this.length;n++)if(this[n].name==t)return this[n]},setTimeInterval:function(t){this.timeInterval=t/1e3},setTimeBase:function(t){this.timeBase=t},dump:function(){var t={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};return this.forEach(function(n){var e={color:n.color,name:n.name,data:[]};n.data.forEach(function(t){e.data.push({x:t.x,y:t.y})}),t.items.push(e)}),t},load:function(t){t.timeInterval&&(this.timeInterval=t.timeInterval),t.timeBase&&(this.timeBase=t.timeBase),t.items&&t.items.forEach(function(t){this.push(t),this.legend&&this.legend.addLine(this.itemByName(t.name))},this)}}),Rickshaw.Series.zeroFill=function(t){Rickshaw.Series.fill(t,0)},Rickshaw.Series.fill=function(t,n){for(var e,r=0,i=t.map(function(t){return t.data});r<Math.max.apply(null,i.map(function(t){return t.length}));)e=Math.min.apply(null,i.filter(function(t){return t[r]}).map(function(t){return t[r].x})),i.forEach(function(t){t[r]&&t[r].x==e||t.splice(r,0,{x:e,y:n})}),r++},Rickshaw.namespace("Rickshaw.Series.FixedDuration"),Rickshaw.Series.FixedDuration=Rickshaw.Class.create(Rickshaw.Series,{initialize:function(t,n,e){if(e=e||{},"undefined"==typeof e.timeInterval)throw new Error("FixedDuration series requires timeInterval");if("undefined"==typeof e.maxDataPoints)throw new Error("FixedDuration series requires maxDataPoints");if(this.palette=new Rickshaw.Color.Palette(n),this.timeBase="undefined"==typeof e.timeBase?Math.floor((new Date).getTime()/1e3):e.timeBase,this.setTimeInterval(e.timeInterval),this[0]&&this[0].data&&this[0].data.length?(this.currentSize=this[0].data.length,this.currentIndex=this[0].data.length):(this.currentSize=0,this.currentIndex=0),this.maxDataPoints=e.maxDataPoints,t&&"object"==typeof t&&Array.isArray(t)&&(t.forEach(function(t){this.addItem(t)},this),this.currentSize+=1,this.currentIndex+=1),this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval,"undefined"!=typeof this.maxDataPoints&&this.currentSize<this.maxDataPoints)for(var r=this.maxDataPoints-this.currentSize-1;r>1;r--)this.currentSize+=1,this.currentIndex+=1,this.forEach(function(t){t.data.unshift({x:((r-1)*this.timeInterval||1)+this.timeBase,y:0,i:r})},this)},addData:function($super,t,n){if($super(t,n),this.currentSize+=1,this.currentIndex+=1,void 0!==this.maxDataPoints)for(;this.currentSize>this.maxDataPoints;)this.dropData()},dropData:function(){this.forEach(function(t){t.data.splice(0,1)}),this.currentSize-=1},getIndex:function(){return this.currentIndex}});
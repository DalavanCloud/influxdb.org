<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Visualizing Bitcoin post frequency on HN with InfluxDB and Rickshaw</title><script src="//fast.fonts.net/jsapi/2de9def5-2dd1-4d89-b4bb-cd7e5f821645.js" type="text/javascript"></script><link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/foundation.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/highlighting.css" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700" rel="stylesheet" type="text/css" /><link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script></head><body class="blog blog_2013 blog_2013_11 blog_2013_11_19 blog_2013_11_19_visualizing_bitcoin_post_frequency_on_hn_using_influxdb_and_rickshaw"><header class="navigation"><div class="menu-wrapper"><a class="logo" href="/"><img src="/images/influxdb-light400.png" /></a><p class="navigation-menu-button" id="js-mobile-menu">MENU</p><div class="nav"><ul id="navigation-menu"><li class="nav-link"><a href="/docs/v0.7/introduction/overview.html">Overview</a></li><li class="nav-link"><a target="blank" href="https://customers.influxdb.com">Support & Hosting</a></li><li class="nav-link"><a href="/blog">Blog</a></li><li class="nav-link"><a href="/docs/v0.7/introduction/getting_started.html">Docs</a></li><li class="nav-link"><a href="/community">Community</a></li><li class="nav-link"><a target="blank" href="http://play.influxdb.org">Play</a></li></ul></div><div class="navigation-tools"><a class="sign-up" href="/download">Download</a></div></div></header><section class="main"><div class="row"><div class="large-12 columns"><h1 class="docs header">InfluxDB Blog</h1><hr /></div></div><div class="row padding-bottom-large"><div class="large-8 columns"><h2>Visualizing Bitcoin post frequency on HN with InfluxDB and Rickshaw</h2><div class="row"><div class="large-9 columns"><h5 class="subheader">November 19, 2013 by Todd Persen</h5></div><div class="large-3 columns"><p id="twitter"><a class="twitter-share-button" data-via="influxdb" href="https://twitter.com/share"></a></p><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div></div><article><p>Based on casual observation, the crowd at HackerNews seems to be totally obsessed 
with Bitcoin and it seems to be reaching a fever pitch. What better way to 
look at the HN Bitcoin obsession than with a visualization? In this post we&rsquo;ll 
use InfluxDB and Rickshaw to create a visualization of the number of posts with 
Bitcoin in the title on HN.</p>

<p>InfluxDB has a straightforward and snappy HTTP API that makes it easy to
pull your time series data out in real-time for use in user interfaces and
visualizations. This makes it a great pairing with <a href="http://d3js.org">D3</a>,
a data visualization library written in JavaScript.</p>

<p>First, we need to load InfluxDB with the data of Bitcoin posts over time. We&rsquo;ll use an 
open <a href="https://www.hnsearch.com/api">Hacker News API</a> to get a list of the last 1,000 
posts containing the phrase <code>bitcoin</code> in the title. Here&rsquo;s a quick ruby script that 
also leverages the InfluxDB rubygem for writing data into the database:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s2">"rubygems"</span>
<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"uri"</span>
<span class="nb">require</span> <span class="s2">"json"</span>
<span class="nb">require</span> <span class="s2">"time"</span>
<span class="nb">require</span> <span class="s2">"influxdb"</span>

<span class="no">QUERY</span> <span class="o">=</span> <span class="s2">"bitcoin"</span>

<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"api.thriftdb.com"</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>
<span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>

<span class="n">influxdb</span> <span class="o">=</span> <span class="no">InfluxDB</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"bitcoin"</span><span class="p">,</span> <span class="p">{</span>
  <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="s2">"sandbox.influxdb.org"</span><span class="p">,</span>
  <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="mi">9061</span><span class="p">,</span>
  <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="s2">"todd"</span><span class="p">,</span>
  <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">"password"</span>
<span class="p">}</span>

<span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">9</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">count</span><span class="o">|</span>
  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"q"</span> <span class="o">=&gt;</span> <span class="no">QUERY</span><span class="p">,</span>
    <span class="s2">"start"</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">*</span><span class="n">count</span><span class="p">,</span>
    <span class="s2">"limit"</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">"sortby"</span> <span class="o">=&gt;</span> <span class="s2">"create_ts desc"</span><span class="p">,</span>
    <span class="s2">"weights[title]"</span> <span class="o">=&gt;</span> <span class="s2">"1.0"</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"/api.hnsearch.com/items/_search?"</span> <span class="o">+</span>
    <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>

  <span class="n">data</span><span class="o">[</span><span class="s2">"results"</span><span class="o">]</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
    <span class="n">influxdb</span><span class="p">.</span><span class="nf">write_point</span><span class="p">(</span><span class="s2">"posts"</span><span class="p">,</span> <span class="p">{</span>
      <span class="ss">:message</span> <span class="o">=&gt;</span> <span class="n">result</span><span class="o">[</span><span class="s2">"item"</span><span class="o">][</span><span class="s2">"title"</span><span class="o">]</span><span class="p">,</span>
      <span class="ss">:time</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="s2">"item"</span><span class="o">][</span><span class="s2">"create_ts"</span><span class="o">]</span><span class="p">).</span><span class="nf">to_i</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>

<p>If you don&rsquo;t have a local installation of InfluxDB handy, head on over
to our <a href="http://play.influxdb.org">InfluxDB Playground</a> and create a free
database to experiment with. Once we have our data available, we can turn to the fun part - visualization.
To make things easier, we&rsquo;re going to use a wrapper for D3
called <a href="http://code.shutterstock.com/rickshaw/">Rickshaw</a>, which was written
by the gang over at Shutterstock.</p>

<p>We&rsquo;ll just use the <a href="https://github.com/influxdb/influxdb-js">InfluxDB Javascript Library</a>
to fetch the data, and then feed that right into a simple line chart in Rickshaw.</p>
<pre class="highlight javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">influxdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InfluxDB</span><span class="p">(</span><span class="s2">"sandbox.influxdb.org"</span><span class="p">,</span> <span class="mi">9061</span><span class="p">,</span> <span class="s2">"todd"</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">,</span> <span class="s2">"bitcoin"</span><span class="p">);</span>

  <span class="nx">influxdb</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">"SELECT COUNT(message) FROM posts WHERE time &gt; now() - 365d GROUP BY time(24h);"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">points</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">points</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">point</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">x</span><span class="p">:</span> <span class="nx">point</span><span class="p">.</span><span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="nx">point</span><span class="p">.</span><span class="nx">count</span> <span class="p">};</span>
    <span class="p">}).</span><span class="nx">reverse</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">({</span>
      <span class="na">element</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#chart"</span><span class="p">),</span>
      <span class="na">width</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span>
      <span class="na">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="na">renderer</span><span class="p">:</span> <span class="s1">'line'</span><span class="p">,</span>
      <span class="na">series</span><span class="p">:</span> <span class="p">[{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span> <span class="na">color</span><span class="p">:</span> <span class="s1">'steelblue'</span> <span class="p">}]</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Time</span><span class="p">({</span> <span class="na">graph</span><span class="p">:</span> <span class="nx">graph</span> <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Y</span><span class="p">({</span>
      <span class="na">graph</span><span class="p">:</span> <span class="nx">graph</span><span class="p">,</span>
      <span class="na">orientation</span><span class="p">:</span> <span class="s1">'left'</span><span class="p">,</span>
      <span class="na">element</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'y_axis'</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="nx">xAxis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="nx">yAxis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre>

<p>Since InfluxDB lets us easily query the time series data, all we need is a simple
transformation and then it&rsquo;s ready to feed directly into Rickshaw.</p>

<p>You can view, run, and modify the entire thing on this JSFiddle:</p>

<iframe width="100%" height="270" style="margin-bottom: 20px;" src="http://jsfiddle.net/toddpersen/46ZRj/15/embedded/result,js,html,css" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Looking at the frequency over time it definitely seems to be picking up along with Bitcoin&rsquo;s price.</p>
</article><hr style="margin-top:30px; margin-bottom:30px"/>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'influxdb';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><div class="large-4 columns"><h4>Posts</h4><p><a href="/blog/2014/05/21/free_trial_for_influxdb_hosting_and_updated_docs.html">Free trial for InfluxDB hosting and updated documentation</a></p><p><a href="/blog/2014/04/30/java-is-the-cobol-of-my-generation-and-go-is-its-successor.html">Java is the COBOL of my generation and Go is its successor (and other reflections after GopherCon)</a></p><p><a href="/blog/2014/03/24/influxdb_v0_5_0_ready_for_production.html">InfluxDB v0.5.0 ready for production</a></p><hr /><h4>About InfluxDB</h4><p>InfluxDB is an open source distributed time series, metrics, and events database.</p><hr /><h4>Sign Up For Our Newsletter</h4><!-- Begin MailChimp Signup Form -->
<div id="newsletter-signup">
<form action="http://errplane.us5.list-manage.com/subscribe/post?u=4d17b6adac2728b1ea6e4926b&amp;id=08af34971b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
  <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button radius"></div>
</form>
</div>

<!--End mc_embed_signup-->
</div></div></section><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45024174-1', 'influxdb.org');
ga('send', 'pageview');</script></body></html>
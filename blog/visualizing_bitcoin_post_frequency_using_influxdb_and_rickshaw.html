<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>Visualizing Bitcoin Post Frequency Using InfluxDB And Rickshaw</title><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/foundation.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlighting.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script></head><body class="blog blog_visualizing_bitcoin_post_frequency_using_influxdb_and_rickshaw"><nav class="top-bar hide-for-small"><ul class="title-area"><li class="name"><h1><a href="/">InfluxDB</a></h1></li></ul><li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li><section class="top-bar-section"><ul class="right"><li class="divider"></li><li><a href="/overview">Overview</a></li><li class="divider"></li><li><a href="/blog">Blog</a></li><li class="divider"></li><li><a href="/docs">Docs</a></li><li class="divider"></li><li><a href="/community">Community</a></li><li class="divider"></li><li><a target="_" href="http://play.influxdb.org">Play</a></li><li class="divider"></li><li class="has-form"><a class="button" href="/download">Download</a></li></ul></section></nav><section id="blog"><div class="row"><div class="large-12 columns"><h1 class="docs header">InfluxDB Blog</h1><hr /></div></div><div class="row padding-bottom-large"><div class="large-8 columns"><h2>Visualizing Bitcoin Post Frequency Using InfluxDB And Rickshaw</h2><div class="row"><div class="large-9 columns"><h5 class="subheader">November 18, 2013 by Todd Persen</h5></div><div class="large-3 columns"><p id="twitter"><a class="twitter-share-button" data-via="influxdb" href="https://twitter.com/share"></a></p><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div></div><p>InfluxDB has a straightforward and snappy HTTP API that makes it easy to
pull your time series data out in real-time for use in user interfaces and
visualizations. This makes it a great pairing with <a href="http://d3js.org">D3</a>,
a data visualization library written in JavaScript.</p>

<p>First, we need to supply InfluxDB with some seed data. In practice, you would
probably have a much larger, less-accessible dataset, but for the sake of
demonstration, let&rsquo;s use an open <a href="https://www.hnsearch.com/api">Hacker News API</a>
to get a list of the last 1,000 posts containing the phrase <code>bitcoin</code> in the
title. Here&rsquo;s a quick ruby script that also leverages the InfluxDB rubygem for
the writing of data:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s2">&quot;rubygems&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;net/http&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;net/https&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;uri&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;json&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;time&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;influxdb&quot;</span>

<span class="no">QUERY</span> <span class="o">=</span> <span class="s2">&quot;bitcoin&quot;</span>

<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="nf">.new</span><span class="p">(</span><span class="s2">&quot;api.thriftdb.com&quot;</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>
<span class="n">http</span><span class="nf">.use_ssl</span> <span class="o">=</span> <span class="kp">true</span>

<span class="n">influxdb</span> <span class="o">=</span> <span class="no">InfluxDB</span><span class="o">::</span><span class="no">Client</span><span class="nf">.new</span> <span class="s2">&quot;tp-tweets1&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="s2">&quot;sandbox.influxdb.org&quot;</span><span class="p">,</span>
  <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="mi">9061</span><span class="p">,</span>
  <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="s2">&quot;todd&quot;</span><span class="p">,</span>
  <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;password&quot;</span>
<span class="p">}</span>

<span class="p">(</span><span class="mi">0</span><span class="nf">..</span><span class="mi">9</span><span class="p">)</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">count</span><span class="o">|</span>
  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;q&quot;</span> <span class="o">=&gt;</span> <span class="no">QUERY</span><span class="p">,</span>
    <span class="s2">&quot;start&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">*</span><span class="n">count</span><span class="p">,</span>
    <span class="s2">&quot;limit&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;sortby&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;create_ts desc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weights[title]&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="nf">.new</span> <span class="s2">&quot;/api.hnsearch.com/items/_search?&quot;</span> <span class="o">+</span>
    <span class="no">URI</span><span class="nf">.encode_www_form</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="nf">.request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="no">JSON</span><span class="nf">.parse</span><span class="p">(</span><span class="n">response</span><span class="nf">.body</span><span class="p">)</span>

  <span class="n">data</span><span class="o">[</span><span class="s2">&quot;results&quot;</span><span class="o">]</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
    <span class="n">influxdb</span><span class="nf">.write_point</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="ss">:message</span> <span class="o">=&gt;</span> <span class="n">result</span><span class="o">[</span><span class="s2">&quot;item&quot;</span><span class="o">][</span><span class="s2">&quot;title&quot;</span><span class="o">]</span><span class="p">,</span>
      <span class="ss">:time</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="nf">.parse</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="s2">&quot;item&quot;</span><span class="o">][</span><span class="s2">&quot;create_ts&quot;</span><span class="o">]</span><span class="p">)</span><span class="nf">.to_i</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>If you don&rsquo;t have a local installation of InfluxDB handy, head on over
to our <a href="http://play.influxdb.org">InfluxDB Playground</a> and create a free
database to experiment with. Once you&rsquo;ve got your username and password,
you can replace the ones in this script.</p>

<p>Once we have our data available, we can turn to the fun part - visualization.
To make things even easier, we&rsquo;re going to use a wrapper for D3
called <a href="http://code.shutterstock.com/rickshaw/">Rickshaw</a>, which was written
by the gang over at Shutterstock.</p>

<p>We&rsquo;ll just use the <a href="https://github.com/influxdb/influxdb-js">InfluxDB Javascript Library</a>
to fetch the data, and then feed that right into Rickshaw a simple line chart.</p>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">influxdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InfluxDB</span><span class="p">(</span><span class="s2">&quot;sandbox.influxdb.org&quot;</span><span class="p">,</span> <span class="mi">9061</span><span class="p">,</span> <span class="s2">&quot;todd&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;bitcoin&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">influxdb</span><span class="p">.</span><span class="nx">_readPoint</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(message) FROM posts WHERE time &gt; now() - 365d GROUP BY time(24h);&quot;</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="nx">response</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">points</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">point</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">x</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>
      <span class="na">y</span><span class="p">:</span> <span class="nx">point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">};</span>
  <span class="p">}).</span><span class="nx">reverse</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">({</span>
    <span class="na">element</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#chart&quot;</span><span class="p">),</span>
    <span class="na">width</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span>
    <span class="na">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="na">renderer</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
    <span class="na">series</span><span class="p">:</span> <span class="p">[{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">points</span><span class="p">,</span> <span class="na">color</span><span class="p">:</span> <span class="s1">&#39;steelblue&#39;</span> <span class="p">}]</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Time</span><span class="p">({</span>
    <span class="na">graph</span><span class="p">:</span> <span class="nx">graph</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Y</span><span class="p">({</span>
    <span class="na">graph</span><span class="p">:</span> <span class="nx">graph</span><span class="p">,</span>
    <span class="na">orientation</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="na">element</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;y_axis&#39;</span><span class="p">),</span>
    <span class="na">ticks</span><span class="p">:</span> <span class="mi">5</span>
  <span class="p">});</span>

  <span class="nx">xAxis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="nx">yAxis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="nx">graph</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="p">});</span>
</pre>
<p>Since InfluxDB lets us easily query the time series data, all we need is a simple
transformation and then it&rsquo;s ready to feed directly into Rickshaw.</p>

<p>You can view, run, and modify the entire thing on this Fiddle:</p>

<iframe width="100%" height="270" src="http://jsfiddle.net/toddpersen/46ZRj/8/embedded/result,js,html,css" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
<hr style="margin-top:30px; margin-bottom:30px"/>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'influxdb';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><div class="large-4 columns"><h4>Other Posts</h4><a href="/blog/visualizing_bitcoin_post_frequency_using_influxdb_and_rickshaw.html">Visualizing Bitcoin Post Frequency Using InfluxDB And Rickshaw</a><hr /><h4>About InfluxDB</h4><p>InfluxDB is a time series database.</p></div></div></section><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45024174-1', 'influxdb.org');
ga('send', 'pageview');</script></body></html>
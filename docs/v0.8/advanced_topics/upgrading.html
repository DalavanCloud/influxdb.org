<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>Upgrading from previous versions</title><script src="//fast.fonts.net/jsapi/2de9def5-2dd1-4d89-b4bb-cd7e5f821645.js" type="text/javascript"></script><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script></head><body class="docs docs_v0"><header class="navigation"><div class="menu-wrapper"><a class="logo" href="/"><img src="/images/influxdb-light400.png" /></a><p class="navigation-menu-button" id="js-mobile-menu">MENU</p><div class="nav"><ul id="navigation-menu"><li class="nav-link"><a href="/docs/v0.8/introduction/overview.html">Overview</a></li><li class="nav-link"><a target="blank" href="https://customers.influxdb.com">Support & Hosting</a></li><li class="nav-link"><a href="/blog">Blog</a></li><li class="nav-link"><a href="/docs/v0.8/introduction/getting_started.html">Docs</a></li><li class="nav-link"><a href="/community">Community</a></li><li class="nav-link"><a target="blank" href="http://play.influxdb.org">Play</a></li></ul></div><div class="navigation-tools"><a class="sign-up" href="/download">Download</a></div></div></header><section role="main"><div class="row"><div class="large-4 medium-4 columns"><div class="sidebar"><nav><ul class="side-nav"><li class="heading">Introduction</li><li><a href="/docs/v0.8/introduction/overview.html">Overview</a></li><li><a href="/docs/v0.8/introduction/installation.html">Installation</a></li><li><a href="/docs/v0.8/introduction/getting_started.html">Getting Started</a></li><li class="divider"></li><li class="heading">API</li><li><a href="/docs/v0.8/api/reading_and_writing_data.html">Reading & Writing Data</a></li><li><a href="/docs/v0.8/api/query_language.html">Query Language</a></li><li><a href="/docs/v0.8/api/aggregate_functions.html">Aggregate Functions</a></li><li><a href="/docs/v0.8/api/continuous_queries.html">Continuous Queries</a></li><li><a href="/docs/v0.8/api/chunked_responses.html">Chunked HTTP Responses</a></li><li><a href="/docs/v0.8/api/administration.html">Administration</a></li><li class="divider"></li><li class="heading">UI</li><li><a href="/docs/v0.8/ui/built_in_admin_and_explorer.html">Built-in Admin and Explorer Interface</a></li><li><a href="/docs/v0.8/ui/grafana.html">Grafana Dashboards</a></li><li><a href="https://github.com/hakobera/influga">Influga Dashboards</a></li><li class="divider"></li><li class="heading">Advanced Topics</li><li><a href="/docs/v0.8/advanced_topics/sharding_and_storage.html">Underlying Storage and Shards</a></li><li><a href="/docs/v0.8/advanced_topics/configuration_options.html">Configuration Options</a></li><li><a href="/docs/v0.8/advanced_topics/schema_design.html">Schema Design</a></li><li><a href="/docs/v0.8/advanced_topics/performance_considerations.html">Performance Considerations</a></li><li><a href="/docs/v0.8/advanced_topics/security.html">Security</a></li><li><a href="/docs/v0.8/advanced_topics/upgrading.html">Upgrading from Previous Versions</a></li><li class="divider"></li><li class="heading">Clustering</li><li><a href="/docs/v0.8/clustering/design.html">Design</a></li><li><a href="/docs/v0.8/clustering/setup.html">Setup</a></li><li class="divider"></li><li class="heading">Guides</li><li><a href="/docs/v0.8/guides/intro.html">Introduction</a></li><li><a href="/docs/v0.8/guides/replacing_graphite.html">Replacing Graphite</a></li><li><a href="http://www.fluentd.org/guides/recipes/syslog-influxdb">Syslog Analytics with FluentD</a></li><li class="divider"></li><li class="heading">Future Features</li><li><a href="/docs/v0.8/future/binary_protocol.html">Binary Protocol</a></li><li><a href="/docs/v0.8/future/pubsub.html">Pubsub</a></li><li><a href="/docs/v0.8/future/column_indexes.html">Column Indexes and Tags</a></li><li><a href="/docs/v0.8/future/custom_functions.html">Custom Functions</a></li><li><a href="/docs/v0.8/future/security.html">Security Enhancements</a></li><li><a href="/docs/v0.8/future/merge.html">Merging Many Series</a></li><li class="divider"></li><li class="heading">Client Libraries</li><li><a href="/docs/v0.8/client_libraries/javascript.html">JavaScript</a></li><li><a href="https://github.com/influxdb/influxdb-ruby">Ruby</a></li><li><a href="https://github.com/influxdb/influxdb-rails">Rails</a></li><li><a href="/docs/v0.8/client_libraries/python.html">Python</a></li><li><a href="https://github.com/puentesarrin/asyncflux">Python (async Tornado)</a></li><li><a href="/docs/v0.8/client_libraries/node.html">Node.js</a></li><li><a href="/docs/v0.8/client_libraries/php.html">PHP</a></li><li><a href="https://github.com/majst01/influxdb-java">Java</a></li><li><a href="https://github.com/olauzon/capacitor">Clojure</a></li><li><a href="https://github.com/mmaul/cl-influxdb">Common Lisp</a></li><li><a href="https://github.com/novaquark/metrics-influxdb">Java Metrics</a></li><li><a href="https://github.com/influxdb/influxdb-go">Go</a></li><li><a href="https://github.com/rcrowley/go-metrics">Go Metrics</a></li><li><a href="https://github.com/influxdb/influxdb-scala">Scala</a></li><li><a href="https://github.com/influxdb/influxdb-r">R</a></li><li><a href="https://metacpan.org/pod/InfluxDB">Perl</a></li><li><a href="https://github.com/maoe/influxdb-haskell">Haskell</a></li><li class="divider"></li><li class="heading">Contributing</li><li><a href="https://github.com/influxdb/influxdb/blob/master/docs/contributing.md">Building and Contributing</a></li><li><a href="/community/cla.html">CLA</a></li><li><a href="https://github.com/influxdb/influxdb.org">To this Documentation</a></li><li><a href="https://github.com/influxdb/influxdb/blob/master/LICENSE">License (MIT)</a></li><li class="divider"></li><li class="heading">Other Libraries and Tools</li><li><a href="https://github.com/Dieterbe/influx-cli">CLI (Go)</a></li><li><a href="https://github.com/FGRibreau/influxdb-cli">CLI (Node)</a></li><li><a href="https://github.com/phstc/influxdb-cli">CLI (Ruby)</a></li><li><a href="http://grafana.org/">Grafana (dashboards)</a></li><li><a href="https://github.com/vimeo/graphite-influxdb">Graphite-Influxdb bridge</a></li><li><a href="https://github.com/obfuscurity/tasseo">Tasseo (realtime dashboard)</a></li><li><a href="https://github.com/bernd/statsd-influxdb-backend">StatsD Backend</a></li><li><a href="https://github.com/bpaquet/collectd-influxdb-proxy">CollectD Proxy</a></li><li><a href="https://github.com/fangli/fluent-plugin-influxdb">FluentD Plugin</a></li><li><a href="https://github.com/lusis/sensu_influxdb_handler">Sensu Handler</a></li><li><a href="https://github.com/SimpleFinance/chef-handler-influxdb">Chef Handler/Reporter</a></li><li><a href="https://github.com/CargoSense/puppet-influxdb">Config Management via Boxen</a></li><li><a href="https://github.com/savoirfairelinux/mod-influxdb">Shinken module</a></li><li class="divider"></li><li class="heading">Docs Versions</li><li><a href="/docs/v0.6/introduction/overview.html">v0.6</a></li><li><a href="/docs/v0.7/introduction/overview.html">v0.7</a></li><li><a href="/docs/v0.8/introduction/overview.html">v0.8</a></li></ul></nav><a class="button download expand" href="/download" style="margin-bottom: 0;">Download InfluxDB</a></div></div><div class="large-8 medium-8 columns" id="docs"><h1 id="upgrading-from-0.7-to-0.8">Upgrading from 0.7 to 0.8</h1>

<p>Version 0.8 of InfluxDB made some changes to how the underlying storage works. We also introduced <a href="/docs/v0.8/advanced_topics/sharding_and_storage.html">shard spaces</a>. In order to upgrade to 0.8 you&rsquo;ll have to do a few things to get your data moved over and take advantage of these new features.</p>

<p>The first thing you should do is back up your data. Shut down InfluxDB and make copies of the <code>raft</code> and <code>wal</code> directories. The underlying <code>db/shard_db</code> directory won&rsquo;t be modified in any way so you should be safe without backing up the raw database files.</p>

<p>Install version 0.8 and start InfluxDB up. If you have a cluster, shut all of them down upgrade them all and start them back up. Note that none of your old data will show up in queries at this point. Don&rsquo;t be alarmed, we&rsquo;re going to kick off a background migration to move it over. We chose to do it this way so you could have a small amount of down time for accepting writes and let the migration progress while you&rsquo;re still ingesting data.</p>

<p>The upgraded Influx will be able to take writes as soon as it starts. Since you haven&rsquo;t created a shard space yet, a default one will be created for you. You&rsquo;ll probably want to create some shard spaces.</p>

<p>If you want the same shard space structure as version 0.7, it had two shard spaces built in: long term and short term. Their configuration would look like this:</p>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long_term"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"retentionPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"shardDuration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"30d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/^[A-Z].*/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"replicationFactor"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"split"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"short_term"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"retentionPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"shardDuration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/.*/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"replicationFactor"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"split"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Shard spaces belong to a database. So you&rsquo;ll have different spaces for each database you have in Influx. To add these shard spaces to a database called <code>test</code> simply run these commands:</p>
<pre class="highlight shell">curl -X POST <span class="s2">"http://localhost:8086/cluster/shard_spaces/test?u=root&amp;p=root"</span> <span class="se">\</span>
  -d <span class="s1">'{
  "name": "short_term",
  "retentionPolicy": "inf",
  "shardDuration": "7d",
  "regex": "/.*/",
  "replicationFactor": 1,
  "split": 1}'</span>

curl -X POST <span class="s2">"http://localhost:8086/cluster/shard_spaces/test?u=root&amp;p=root"</span> <span class="se">\</span>
  -d <span class="s1">'{
  "name": "long_term",
  "retentionPolicy": "inf",
  "shardDuration": "30d",
  "regex": "/^[A-Z].*/",
  "replicationFactor": 1,
  "split": 1}'</span>
</pre>

<p>And to verify they&rsquo;ve been created:</p>
<pre class="highlight plaintext">curl "http://localhost:8086/cluster/shard_spaces?u=root&amp;p=root"
</pre>

<p>Notice that the least specific shard space (or the default case <code>.*</code>) was created first. When creating shard spaces the order should go from least to most specific. They&rsquo;re evaluated in the reverse order they were created.</p>

<h2 id="kicking-off-the-migration">Kicking off the migration</h2>

<p>Now that you have shard spaces set up, let&rsquo;s get your data migrated over. Simply do this:</p>
<pre class="highlight plaintext">curl -X POST "http://localhost:8086/cluster/migrate_data?u=root&amp;p=root"
</pre>

<p>That&rsquo;ll kick off a migration in the background. It will look in your <code>db/shard_db</code> directory for the shards there. It will migrate each of them highest number to lowest. This will generally mean that most recent data will be migrated first. You should be able to perform writes and queries against Influx while this is running.</p>

<p><strong>NOTE:</strong> By default the migration routine will pause for 100ms after 10,000 points have been migrated. We put this in so that the migration wouldn&rsquo;t completely overwhelm your server. You can adjust this with the query parameter <code>pause</code> like this:</p>
<pre class="highlight plaintext"># no pause
curl -X POST "http://localhost:8086/cluster/migrate_data?u=root&amp;p=root&amp;pause=0s"

# bigger pause
curl -X POST "http://localhost:8086/cluster/migrate_data?u=root&amp;p=root&amp;pause=1s"
</pre>

<p>You can use <code>u</code>, <code>ms</code>, <code>s</code>, and <code>m</code> units on the pause time.</p>

<p>As each shard is migrated a marker file will be written to <code>db/shard_db/00001/MIGRATED</code> where <code>00001</code> is whatever the shard number is. Note that the old shard numbers may not be the same as the new shard numbers. New shards can be found at <code>db/shard_db_v2</code>. You can also keep an eye on the log to see how the migration is progressing. Depending on how much data you have, migration could take a considerable amount of time.</p>

<p><strong>NOTE:</strong> The old data will still remain on disk after it is migrated. You&rsquo;ll want to go through and remove that manually once things are done. Any directory that has a <code>MIGRATED</code> file in it should be safe to delete.</p>
</div></div></section><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45024174-1', 'influxdb.com');
ga('send', 'pageview');</script><script type="text/javascript">(function() {
  $("#docs h1, #docs h2, #docs h3, #docs h4").each(function(i, el) {
    var id, text;
    id = el.id;
    text = $(el).text();
    return $(el).html('<a href="#' + id + '">' + text + '</a>');
  });

}).call(this);
</script></body></html>